/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={912:function(t){t.exports=function(){"use strict";var t=6e4,e=36e5,r="millisecond",n="second",i="minute",o="hour",a="day",s="week",u="month",c="quarter",l="year",f="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,d=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],r=t%100;return"["+t+(e[(r-20)%10]||e[r]||e[0])+"]"}},m=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},y={s:m,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),i=r%60;return(e<=0?"+":"-")+m(n,2,"0")+":"+m(i,2,"0")},m:function t(e,r){if(e.date()<r.date())return-t(r,e);var n=12*(r.year()-e.year())+(r.month()-e.month()),i=e.clone().add(n,u),o=r-i<0,a=e.clone().add(n+(o?-1:1),u);return+(-(n+(r-i)/(o?i-a:a-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:u,y:l,w:s,d:a,D:f,h:o,m:i,s:n,ms:r,Q:c}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},g="en",w={};w[g]=v;var b="$isDayjsObject",x=function(t){return t instanceof S||!(!t||!t[b])},E=function t(e,r,n){var i;if(!e)return g;if("string"==typeof e){var o=e.toLowerCase();w[o]&&(i=o),r&&(w[o]=r,i=o);var a=e.split("-");if(!i&&a.length>1)return t(a[0])}else{var s=e.name;w[s]=e,i=s}return!n&&i&&(g=i),i||!n&&g},k=function(t,e){if(x(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new S(r)},O=y;O.l=E,O.i=x,O.w=function(t,e){return k(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var S=function(){function v(t){this.$L=E(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[b]=!0}var m=v.prototype;return m.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(O.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(p);if(n){var i=n[2]-1||0,o=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)}}return new Date(e)}(t),this.init()},m.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},m.$utils=function(){return O},m.isValid=function(){return!(this.$d.toString()===h)},m.isSame=function(t,e){var r=k(t);return this.startOf(e)<=r&&r<=this.endOf(e)},m.isAfter=function(t,e){return k(t)<this.startOf(e)},m.isBefore=function(t,e){return this.endOf(e)<k(t)},m.$g=function(t,e,r){return O.u(t)?this[e]:this.set(r,t)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(t,e){var r=this,c=!!O.u(e)||e,h=O.p(t),p=function(t,e){var n=O.w(r.$u?Date.UTC(r.$y,e,t):new Date(r.$y,e,t),r);return c?n:n.endOf(a)},d=function(t,e){return O.w(r.toDate()[t].apply(r.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(e)),r)},v=this.$W,m=this.$M,y=this.$D,g="set"+(this.$u?"UTC":"");switch(h){case l:return c?p(1,0):p(31,11);case u:return c?p(1,m):p(0,m+1);case s:var w=this.$locale().weekStart||0,b=(v<w?v+7:v)-w;return p(c?y-b:y+(6-b),m);case a:case f:return d(g+"Hours",0);case o:return d(g+"Minutes",1);case i:return d(g+"Seconds",2);case n:return d(g+"Milliseconds",3);default:return this.clone()}},m.endOf=function(t){return this.startOf(t,!1)},m.$set=function(t,e){var s,c=O.p(t),h="set"+(this.$u?"UTC":""),p=(s={},s[a]=h+"Date",s[f]=h+"Date",s[u]=h+"Month",s[l]=h+"FullYear",s[o]=h+"Hours",s[i]=h+"Minutes",s[n]=h+"Seconds",s[r]=h+"Milliseconds",s)[c],d=c===a?this.$D+(e-this.$W):e;if(c===u||c===l){var v=this.clone().set(f,1);v.$d[p](d),v.init(),this.$d=v.set(f,Math.min(this.$D,v.daysInMonth())).$d}else p&&this.$d[p](d);return this.init(),this},m.set=function(t,e){return this.clone().$set(t,e)},m.get=function(t){return this[O.p(t)]()},m.add=function(r,c){var f,h=this;r=Number(r);var p=O.p(c),d=function(t){var e=k(h);return O.w(e.date(e.date()+Math.round(t*r)),h)};if(p===u)return this.set(u,this.$M+r);if(p===l)return this.set(l,this.$y+r);if(p===a)return d(1);if(p===s)return d(7);var v=(f={},f[i]=t,f[o]=e,f[n]=1e3,f)[p]||1,m=this.$d.getTime()+r*v;return O.w(m,this)},m.subtract=function(t,e){return this.add(-1*t,e)},m.format=function(t){var e=this,r=this.$locale();if(!this.isValid())return r.invalidDate||h;var n=t||"YYYY-MM-DDTHH:mm:ssZ",i=O.z(this),o=this.$H,a=this.$m,s=this.$M,u=r.weekdays,c=r.months,l=r.meridiem,f=function(t,r,i,o){return t&&(t[r]||t(e,n))||i[r].slice(0,o)},p=function(t){return O.s(o%12||12,t,"0")},v=l||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(d,(function(t,n){return n||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return O.s(e.$y,4,"0");case"M":return s+1;case"MM":return O.s(s+1,2,"0");case"MMM":return f(r.monthsShort,s,c,3);case"MMMM":return f(c,s);case"D":return e.$D;case"DD":return O.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return f(r.weekdaysMin,e.$W,u,2);case"ddd":return f(r.weekdaysShort,e.$W,u,3);case"dddd":return u[e.$W];case"H":return String(o);case"HH":return O.s(o,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return v(o,a,!0);case"A":return v(o,a,!1);case"m":return String(a);case"mm":return O.s(a,2,"0");case"s":return String(e.$s);case"ss":return O.s(e.$s,2,"0");case"SSS":return O.s(e.$ms,3,"0");case"Z":return i}return null}(t)||i.replace(":","")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(r,f,h){var p,d=this,v=O.p(f),m=k(r),y=(m.utcOffset()-this.utcOffset())*t,g=this-m,w=function(){return O.m(d,m)};switch(v){case l:p=w()/12;break;case u:p=w();break;case c:p=w()/3;break;case s:p=(g-y)/6048e5;break;case a:p=(g-y)/864e5;break;case o:p=g/e;break;case i:p=g/t;break;case n:p=g/1e3;break;default:p=g}return h?p:O.a(p)},m.daysInMonth=function(){return this.endOf(u).$D},m.$locale=function(){return w[this.$L]},m.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),n=E(t,e,!0);return n&&(r.$L=n),r},m.clone=function(){return O.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},v}(),_=S.prototype;return k.prototype=_,[["$ms",r],["$s",n],["$m",i],["$H",o],["$W",a],["$M",u],["$y",l],["$D",f]].forEach((function(t){_[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),k.extend=function(t,e){return t.$i||(t(e,S,k),t.$i=!0),k},k.locale=E,k.isDayjs=x,k.unix=function(t){return k(1e3*t)},k.en=w[g],k.Ls=w,k.p={},k}()},24:(t,e,r)=>{var n=r(735).default;function i(){"use strict";t.exports=i=function(){return r},t.exports.__esModule=!0,t.exports.default=t.exports;var e,r={},o=Object.prototype,a=o.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",l=u.asyncIterator||"@@asyncIterator",f=u.toStringTag||"@@toStringTag";function h(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(e){h=function(t,e,r){return t[e]=r}}function p(t,e,r,n){var i=e&&e.prototype instanceof b?e:b,o=Object.create(i.prototype),a=new D(n||[]);return s(o,"_invoke",{value:N(t,r,a)}),o}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=p;var v="suspendedStart",m="suspendedYield",y="executing",g="completed",w={};function b(){}function x(){}function E(){}var k={};h(k,c,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(C([])));S&&S!==o&&a.call(S,c)&&(k=S);var _=E.prototype=b.prototype=Object.create(k);function A(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(i,o,s,u){var c=d(t[i],t,o);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==n(f)&&a.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,s,u)}),(function(t){r("throw",t,s,u)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,u)}))}u(c.arg)}var i;s(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(o,o):o()}})}function N(t,r,n){var i=v;return function(o,a){if(i===y)throw Error("Generator is already running");if(i===g){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=M(s,n);if(u){if(u===w)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===v)throw i=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=y;var c=d(t,r,n);if("normal"===c.type){if(i=n.done?g:m,c.arg===w)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=g,n.method="throw",n.arg=c.arg)}}}function M(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,M(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),w;var o=d(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,w;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,w):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,w)}function $(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function D(t){this.tryEntries=[{tryLoc:"root"}],t.forEach($,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(a.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(n(t)+" is not iterable")}return x.prototype=E,s(_,"constructor",{value:E,configurable:!0}),s(E,"constructor",{value:x,configurable:!0}),x.displayName=h(E,f,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,h(t,f,"GeneratorFunction")),t.prototype=Object.create(_),t},r.awrap=function(t){return{__await:t}},A(T.prototype),h(T.prototype,l,(function(){return this})),r.AsyncIterator=T,r.async=function(t,e,n,i,o){void 0===o&&(o=Promise);var a=new T(p(t,e,n,i),o);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},A(_),h(_,f,"Generator"),h(_,c,(function(){return this})),h(_,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=C,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,w):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),w},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),w}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),w}},r}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{CALCULATE:()=>l,Condition:()=>Y,ConditionList:()=>Pt,HumanizeUtils:()=>d,OPERATOR:()=>c,RewardList:()=>Ut,addCondition:()=>v,addReward:()=>y,addRewardSelection:()=>w,extend:()=>It,getConditionMap:()=>H,getConditions:()=>V,rewardValueConvert:()=>g,triggerCondition:()=>$,triggerConditions:()=>L,userValueUtil:()=>Ct});const t=flarum.core.compat["forum/app"];var e=r.n(t);function i(t,e,r,n,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function s(t){i(a,n,o,s,u,"next",t)}function u(t){i(a,n,o,s,u,"throw",t)}s(void 0)}))}}var a=r(183),s=r.n(a);const u=flarum.core.compat["common/extend"];var c=function(t){return t.EQUAL="=",t.NOT_EQUAL="!=",t.GREATER_THAN=">",t.LESS_THAN="<",t.GREATER_THAN_OR_EQUAL=">=",t.LESS_THAN_OR_EQUAL="<=",t}({}),l=function(t){return t[t.SUM=1]="SUM",t[t.MAX=2]="MAX",t[t.DAY_COUNT=3]="DAY_COUNT",t}({});const f=flarum.core.compat["common/utils/ItemList"];var h=r.n(f),p={">=":"ge",">":"gt","<=":"le","<":"lt","=":"eq","!=":"ne"},d=function(){function t(t){this.app=void 0,this.definitionLoaded=!1,this.rawConditionDefinition={},this.conditionTranslations={},this.rewardTranslations={},this.conditionsKeys=[],this.rewardsKeys=[],this.app=t}var e=t.prototype;return e.loadDefinition=function(){var t=o(s().mark((function t(){var e;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.definitionLoaded){t.next=2;break}return t.abrupt("return");case 2:if(!this.app.data["collector-definition"]){t.next=5;break}return this._loadDefinition(this.app.data["collector-definition"]),t.abrupt("return");case 5:return t.next=7,this.app.request({method:"GET",url:this.app.forum.attribute("apiUrl")+"/collector-data"});case 7:e=t.sent,this._loadDefinition(e);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e._loadDefinition=function(t){var e=this;t.conditions.forEach((function(t){e.conditionTranslations[t.key]=t.trans,e.conditionsKeys.push(t.key),e.rawConditionDefinition[t.key]=t})),t.rewards.forEach((function(t){e.rewardTranslations[t.key]=t.trans,e.rewardsKeys.push(t.key)})),this.definitionLoaded=!0},t.getInstance=function(e){return this.instance||(this.instance=new t(e)),this.instance},e.getAllConditions=function(t){var e=this;void 0===t&&(t=!1);var r=new(h());return this.conditionsKeys.forEach((function(n){!t&&e.rawConditionDefinition[n].global||r.add(n,e.conditionTranslations[n])})),r},e.getAllRewards=function(){var t=this,e=new(h());return this.rewardsKeys.forEach((function(r){e.add(r,t.rewardTranslations[r])})),e},e.getConditionName=function(t){return this.getAllConditions().has(t)?this.getAllConditions().get(t):t},e.getRewardName=function(t){return this.getAllRewards().has(t)?this.getAllRewards().get(t):t},e.getRewardValue=function(t,e){return e},e.rewardSelection=function(){var t=o(s().mark((function t(e){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return","");case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.humanizeCondition=function(t){var e=this;if(Array.isArray(t))return t.map((function(t){return e.humanizeCondition(t)}));if(t.alter_name)return t.alter_name;var r=t.span?this.app.translator.trans("xypp-collector.forum.condition.span",{span:t.span}):"";return Array.isArray(r)&&(r=r.join("")),this.app.translator.trans("xypp-collector.forum.condition.format",{b:m("b",null),name:this.getConditionName(t.name),operator:this.app.translator.trans("xypp-collector.lib.operator."+p[t.operator]),value:t.value,calculate:this.getCalculate(t.calculate||l.SUM),span:r})},e.humanizeReward=function(t){var e=this;return Array.isArray(t)?t.map((function(t){return e.humanizeReward(t)})):t.alter_name?t.alter_name:this.app.translator.trans("xypp-collector.forum.reward.format",{b:m("b",null),name:this.getRewardName(t.name),value:this.getRewardValue(t.name,t.value)})},e.getCalculate=function(t){var e,r=((e={})[l.SUM]="sum",e[l.MAX]="max",e[l.DAY_COUNT]="days",e);return this.app.translator.trans("xypp-collector.lib.calculate."+r[t])},e.getRawConditionDefinition=function(t){return this.rawConditionDefinition[t]||!1},t}();function v(t,e){(0,u.extend)(d.prototype,"getAllConditions",(function(r){r.add(t,e)}))}function y(t,e){(0,u.extend)(d.prototype,"getAllRewards",(function(r){r.add(t,e)}))}function g(t,e){(0,u.override)(d.prototype,"getRewardValue",(function(r,n,i){return t===n?e(i):r(n,i)}))}function w(t,e){(0,u.override)(d.prototype,"rewardSelection",function(){var r=o(s().mark((function r(n,i){return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t!==i){r.next=4;break}return r.abrupt("return",e());case 4:return r.abrupt("return",n(i));case 5:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}())}function b(t,e){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},b(t,e)}function x(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,b(t,e)}d.instance=void 0;const E=flarum.core.compat["common/components/Modal"];var k=r.n(E);const O=flarum.core.compat["common/components/Button"];var S=r.n(O);const _=flarum.core.compat["common/components/Select"];var A=r.n(_),T=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).selection="",e.done=!1,e}x(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.selection=this.attrs.items[Object.keys(this.attrs.items)[0]]},r.className=function(){return"Modal"},r.title=function(){return this.attrs.title},r.oncreate=function(e){t.prototype.oncreate.call(this,e)},r.onremove=function(e){t.prototype.onremove.call(this,e),this.done||this.attrs.cancel()},r.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m(A(),{className:"FormControl",value:this.selection,options:this.attrs.items,onchange:function(e){t.selection=e}.bind(this)})),m("div",{className:"Form-group"},m(S(),{class:"Button Button--primary",type:"submit",loading:this.loading},this.attrs.button))))},r.onsubmit=function(){var t=o(s().mark((function t(e){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),this.done=!0,this.attrs.callback(this.selection);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.open=function(t,r,n,i){return new Promise((function(o,a){t.modal.show(e,{items:r,title:n,button:i,cancel:function(){a()},callback:function(e){o(e),t.modal.close()}},!0)}))},e}(k());const N=flarum.core.compat["forum/components/UserPage"];var M=r.n(N);function $(t,e){var r;return L(((r={})[t]=e,r))}function L(t){var r=Object.keys(t).map((function(e){return{name:e,value:t[e]}}));return e().request({url:e().forum.attribute("apiUrl")+"/collector-condition",method:"POST",body:{data:r}})}var D={},C={};const P=flarum.core.compat["common/Model"];var U=r.n(P),R=r(912),j=r.n(R);function B(t){if(!t)return null;try{return JSON.parse(t)}catch(t){return null}}var I=["all","rest","flg","max","days"],Y=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).name=U().attribute("name"),e.value=U().attribute("value"),e.user_id=U().attribute("user_id"),e.global=U().attribute("global"),e.accumulation=U().attribute("accumulation",B),e}x(e,t);var r=e.prototype;return r.getSpan=function(t,e){void 0===e&&(e=l.SUM),e||(e=l.SUM);var r=this.accumulation();if(!r||t<1)return 0;var n=j()(j()().format("YYYYMMDD"),"YYYYMMDD");1!=t&&(n=n.subtract(t-1,"day"));var i=0;return Object.keys(r).forEach((function(t){if(!I.includes(t)){var o=j()(t,"YYYYMMDD");(o.isAfter(n)||o.isSame(n))&&(e==l.MAX?i=Math.max(i,r[t]):e==l.SUM?i+=r[t]:e==l.DAY_COUNT&&r[t]>0&&(i+=1))}})),i},r.getTotal=function(t){var e,r,n;return void 0===t&&(t=l.SUM),t||(t=l.SUM),t==l.MAX?(null==(e=this.accumulation())?void 0:e.max)||0:t==l.DAY_COUNT?(null==(r=this.accumulation())?void 0:r.days)||0:(null==(n=this.accumulation())?void 0:n.all)||0},e}(U());const F=flarum.core.compat["common/models/User"];var G=r.n(F);function H(t,e){return z.apply(this,arguments)}function z(){return(z=o(s().mark((function t(e,r){var n,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===e&&(e=!1),void 0===r&&(r=null),t.next=4,V(e,r);case 4:return n=t.sent,i={},n.forEach((function(t){i[t.name()]=t})),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function V(t,e){return q.apply(this,arguments)}function q(){return(q=o(s().mark((function t(r,n){var i,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===r&&(r=!1),void 0===n&&(n=null),i=void 0,n&&(i=n instanceof G()?{id:n.id()}:{id:n}),o=e().store.all("collector-condition"),i&&i.id&&(o=o.filter((function(t){return t.global()||t.user_id()==i.id}))),!r&&0!=o.length){t.next=10;break}return t.next=9,e().store.find("collector-condition",i);case 9:o=t.sent;case 10:return t.abrupt("return",o);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}const W=flarum.core.compat["common/Component"];var Q=r.n(W),X=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,J=Math.ceil,K=Math.floor,Z="[BigNumber Error] ",tt=Z+"Number primitive has more than 15 significant digits: ",et=1e14,rt=14,nt=9007199254740991,it=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ot=1e7,at=1e9;function st(t){var e=0|t;return t>0||t===e?e:e-1}function ut(t){for(var e,r,n=1,i=t.length,o=t[0]+"";n<i;){for(e=t[n++]+"",r=rt-e.length;r--;e="0"+e);o+=e}for(i=o.length;48===o.charCodeAt(--i););return o.slice(0,i+1||1)}function ct(t,e){var r,n,i=t.c,o=e.c,a=t.s,s=e.s,u=t.e,c=e.e;if(!a||!s)return null;if(r=i&&!i[0],n=o&&!o[0],r||n)return r?n?0:-s:a;if(a!=s)return a;if(r=a<0,n=u==c,!i||!o)return n?0:!i^r?1:-1;if(!n)return u>c^r?1:-1;for(s=(u=i.length)<(c=o.length)?u:c,a=0;a<s;a++)if(i[a]!=o[a])return i[a]>o[a]^r?1:-1;return u==c?0:u>c^r?1:-1}function lt(t,e,r,n){if(t<e||t>r||t!==K(t))throw Error(Z+(n||"Argument")+("number"==typeof t?t<e||t>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function ft(t){var e=t.c.length-1;return st(t.e/rt)==e&&t.c[e]%2!=0}function ht(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function pt(t,e,r){var n,i;if(e<0){for(i=r+".";++e;i+=r);t=i+t}else if(++e>(n=t.length)){for(i=r,e-=n;--e;i+=r);t+=i}else e<n&&(t=t.slice(0,e)+"."+t.slice(e));return t}var dt=function t(e){var r,n,i,o,a,s,u,c,l,f,h=S.prototype={constructor:S,toString:null,valueOf:null},p=new S(1),d=20,v=4,m=-7,y=21,g=-1e7,w=1e7,b=!1,x=1,E=0,k={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},O="0123456789abcdefghijklmnopqrstuvwxyz";function S(t,e){var r,o,a,s,u,c,l,f,h=this;if(!(h instanceof S))return new S(t,e);if(null==e){if(t&&!0===t._isBigNumber)return h.s=t.s,void(!t.c||t.e>w?h.c=h.e=null:t.e<g?h.c=[h.e=0]:(h.e=t.e,h.c=t.c.slice()));if((c="number"==typeof t)&&0*t==0){if(h.s=1/t<0?(t=-t,-1):1,t===~~t){for(s=0,u=t;u>=10;u/=10,s++);return void(s>w?h.c=h.e=null:(h.e=s,h.c=[t]))}f=String(t)}else{if(!X.test(f=String(t)))return i(h,f,c);h.s=45==f.charCodeAt(0)?(f=f.slice(1),-1):1}(s=f.indexOf("."))>-1&&(f=f.replace(".","")),(u=f.search(/e/i))>0?(s<0&&(s=u),s+=+f.slice(u+1),f=f.substring(0,u)):s<0&&(s=f.length)}else{if(lt(e,2,O.length,"Base"),10==e)return N(h=new S(t),d+h.e+1,v);if(f=String(t),c="number"==typeof t){if(0*t!=0)return i(h,f,c,e);if(h.s=1/t<0?(f=f.slice(1),-1):1,S.DEBUG&&f.replace(/^0\.0*|\./,"").length>15)throw Error(tt+t)}else h.s=45===f.charCodeAt(0)?(f=f.slice(1),-1):1;for(r=O.slice(0,e),s=u=0,l=f.length;u<l;u++)if(r.indexOf(o=f.charAt(u))<0){if("."==o){if(u>s){s=l;continue}}else if(!a&&(f==f.toUpperCase()&&(f=f.toLowerCase())||f==f.toLowerCase()&&(f=f.toUpperCase()))){a=!0,u=-1,s=0;continue}return i(h,String(t),c,e)}c=!1,(s=(f=n(f,e,10,h.s)).indexOf("."))>-1?f=f.replace(".",""):s=f.length}for(u=0;48===f.charCodeAt(u);u++);for(l=f.length;48===f.charCodeAt(--l););if(f=f.slice(u,++l)){if(l-=u,c&&S.DEBUG&&l>15&&(t>nt||t!==K(t)))throw Error(tt+h.s*t);if((s=s-u-1)>w)h.c=h.e=null;else if(s<g)h.c=[h.e=0];else{if(h.e=s,h.c=[],u=(s+1)%rt,s<0&&(u+=rt),u<l){for(u&&h.c.push(+f.slice(0,u)),l-=rt;u<l;)h.c.push(+f.slice(u,u+=rt));u=rt-(f=f.slice(u)).length}else u-=l;for(;u--;f+="0");h.c.push(+f)}}else h.c=[h.e=0]}function _(t,e,r,n){var i,o,a,s,u;if(null==r?r=v:lt(r,0,8),!t.c)return t.toString();if(i=t.c[0],a=t.e,null==e)u=ut(t.c),u=1==n||2==n&&(a<=m||a>=y)?ht(u,a):pt(u,a,"0");else if(o=(t=N(new S(t),e,r)).e,s=(u=ut(t.c)).length,1==n||2==n&&(e<=o||o<=m)){for(;s<e;u+="0",s++);u=ht(u,o)}else if(e-=a,u=pt(u,o,"0"),o+1>s){if(--e>0)for(u+=".";e--;u+="0");}else if((e+=o-s)>0)for(o+1==s&&(u+=".");e--;u+="0");return t.s<0&&i?"-"+u:u}function A(t,e){for(var r,n=1,i=new S(t[0]);n<t.length;n++){if(!(r=new S(t[n])).s){i=r;break}e.call(i,r)&&(i=r)}return i}function T(t,e,r){for(var n=1,i=e.length;!e[--i];e.pop());for(i=e[0];i>=10;i/=10,n++);return(r=n+r*rt-1)>w?t.c=t.e=null:r<g?t.c=[t.e=0]:(t.e=r,t.c=e),t}function N(t,e,r,n){var i,o,a,s,u,c,l,f=t.c,h=it;if(f){t:{for(i=1,s=f[0];s>=10;s/=10,i++);if((o=e-i)<0)o+=rt,a=e,l=(u=f[c=0])/h[i-a-1]%10|0;else if((c=J((o+1)/rt))>=f.length){if(!n)break t;for(;f.length<=c;f.push(0));u=l=0,i=1,a=(o%=rt)-rt+1}else{for(u=s=f[c],i=1;s>=10;s/=10,i++);l=(a=(o%=rt)-rt+i)<0?0:u/h[i-a-1]%10|0}if(n=n||e<0||null!=f[c+1]||(a<0?u:u%h[i-a-1]),n=r<4?(l||n)&&(0==r||r==(t.s<0?3:2)):l>5||5==l&&(4==r||n||6==r&&(o>0?a>0?u/h[i-a]:0:f[c-1])%10&1||r==(t.s<0?8:7)),e<1||!f[0])return f.length=0,n?(e-=t.e+1,f[0]=h[(rt-e%rt)%rt],t.e=-e||0):f[0]=t.e=0,t;if(0==o?(f.length=c,s=1,c--):(f.length=c+1,s=h[rt-o],f[c]=a>0?K(u/h[i-a]%h[a])*s:0),n)for(;;){if(0==c){for(o=1,a=f[0];a>=10;a/=10,o++);for(a=f[0]+=s,s=1;a>=10;a/=10,s++);o!=s&&(t.e++,f[0]==et&&(f[0]=1));break}if(f[c]+=s,f[c]!=et)break;f[c--]=0,s=1}for(o=f.length;0===f[--o];f.pop());}t.e>w?t.c=t.e=null:t.e<g&&(t.c=[t.e=0])}return t}function M(t){var e,r=t.e;return null===r?t.toString():(e=ut(t.c),e=r<=m||r>=y?ht(e,r):pt(e,r,"0"),t.s<0?"-"+e:e)}return S.clone=t,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(t){var e,r;if(null!=t){if("object"!=typeof t)throw Error(Z+"Object expected: "+t);if(t.hasOwnProperty(e="DECIMAL_PLACES")&&(lt(r=t[e],0,at,e),d=r),t.hasOwnProperty(e="ROUNDING_MODE")&&(lt(r=t[e],0,8,e),v=r),t.hasOwnProperty(e="EXPONENTIAL_AT")&&((r=t[e])&&r.pop?(lt(r[0],-at,0,e),lt(r[1],0,at,e),m=r[0],y=r[1]):(lt(r,-at,at,e),m=-(y=r<0?-r:r))),t.hasOwnProperty(e="RANGE"))if((r=t[e])&&r.pop)lt(r[0],-at,-1,e),lt(r[1],1,at,e),g=r[0],w=r[1];else{if(lt(r,-at,at,e),!r)throw Error(Z+e+" cannot be zero: "+r);g=-(w=r<0?-r:r)}if(t.hasOwnProperty(e="CRYPTO")){if((r=t[e])!==!!r)throw Error(Z+e+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw b=!r,Error(Z+"crypto unavailable");b=r}else b=r}if(t.hasOwnProperty(e="MODULO_MODE")&&(lt(r=t[e],0,9,e),x=r),t.hasOwnProperty(e="POW_PRECISION")&&(lt(r=t[e],0,at,e),E=r),t.hasOwnProperty(e="FORMAT")){if("object"!=typeof(r=t[e]))throw Error(Z+e+" not an object: "+r);k=r}if(t.hasOwnProperty(e="ALPHABET")){if("string"!=typeof(r=t[e])||/^.$|[+-.\s]|(.).*\1/.test(r))throw Error(Z+e+" invalid: "+r);O=r}}return{DECIMAL_PLACES:d,ROUNDING_MODE:v,EXPONENTIAL_AT:[m,y],RANGE:[g,w],CRYPTO:b,MODULO_MODE:x,POW_PRECISION:E,FORMAT:k,ALPHABET:O}},S.isBigNumber=function(t){if(!t||!0!==t._isBigNumber)return!1;if(!S.DEBUG)return!0;var e,r,n=t.c,i=t.e,o=t.s;t:if("[object Array]"=={}.toString.call(n)){if((1===o||-1===o)&&i>=-at&&i<=at&&i===K(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break t}if((e=(i+1)%rt)<1&&(e+=rt),String(n[0]).length==e){for(e=0;e<n.length;e++)if((r=n[e])<0||r>=et||r!==K(r))break t;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(Z+"Invalid BigNumber: "+t)},S.maximum=S.max=function(){return A(arguments,h.lt)},S.minimum=S.min=function(){return A(arguments,h.gt)},S.random=(o=9007199254740992,a=Math.random()*o&2097151?function(){return K(Math.random()*o)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(t){var e,r,n,i,o,s=0,u=[],c=new S(p);if(null==t?t=d:lt(t,0,at),i=J(t/rt),b)if(crypto.getRandomValues){for(e=crypto.getRandomValues(new Uint32Array(i*=2));s<i;)(o=131072*e[s]+(e[s+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),e[s]=r[0],e[s+1]=r[1]):(u.push(o%1e14),s+=2);s=i/2}else{if(!crypto.randomBytes)throw b=!1,Error(Z+"crypto unavailable");for(e=crypto.randomBytes(i*=7);s<i;)(o=281474976710656*(31&e[s])+1099511627776*e[s+1]+4294967296*e[s+2]+16777216*e[s+3]+(e[s+4]<<16)+(e[s+5]<<8)+e[s+6])>=9e15?crypto.randomBytes(7).copy(e,s):(u.push(o%1e14),s+=7);s=i/7}if(!b)for(;s<i;)(o=a())<9e15&&(u[s++]=o%1e14);for(i=u[--s],t%=rt,i&&t&&(o=it[rt-t],u[s]=K(i/o)*o);0===u[s];u.pop(),s--);if(s<0)u=[n=0];else{for(n=-1;0===u[0];u.splice(0,1),n-=rt);for(s=1,o=u[0];o>=10;o/=10,s++);s<rt&&(n-=rt-s)}return c.e=n,c.c=u,c}),S.sum=function(){for(var t=1,e=arguments,r=new S(e[0]);t<e.length;)r=r.plus(e[t++]);return r},n=function(){var t="0123456789";function e(t,e,r,n){for(var i,o,a=[0],s=0,u=t.length;s<u;){for(o=a.length;o--;a[o]*=e);for(a[0]+=n.indexOf(t.charAt(s++)),i=0;i<a.length;i++)a[i]>r-1&&(null==a[i+1]&&(a[i+1]=0),a[i+1]+=a[i]/r|0,a[i]%=r)}return a.reverse()}return function(n,i,o,a,s){var u,c,l,f,h,p,m,y,g=n.indexOf("."),w=d,b=v;for(g>=0&&(f=E,E=0,n=n.replace(".",""),p=(y=new S(i)).pow(n.length-g),E=f,y.c=e(pt(ut(p.c),p.e,"0"),10,o,t),y.e=y.c.length),l=f=(m=e(n,i,o,s?(u=O,t):(u=t,O))).length;0==m[--f];m.pop());if(!m[0])return u.charAt(0);if(g<0?--l:(p.c=m,p.e=l,p.s=a,m=(p=r(p,y,w,b,o)).c,h=p.r,l=p.e),g=m[c=l+w+1],f=o/2,h=h||c<0||null!=m[c+1],h=b<4?(null!=g||h)&&(0==b||b==(p.s<0?3:2)):g>f||g==f&&(4==b||h||6==b&&1&m[c-1]||b==(p.s<0?8:7)),c<1||!m[0])n=h?pt(u.charAt(1),-w,u.charAt(0)):u.charAt(0);else{if(m.length=c,h)for(--o;++m[--c]>o;)m[c]=0,c||(++l,m=[1].concat(m));for(f=m.length;!m[--f];);for(g=0,n="";g<=f;n+=u.charAt(m[g++]));n=pt(n,l,u.charAt(0))}return n}}(),r=function(){function t(t,e,r){var n,i,o,a,s=0,u=t.length,c=e%ot,l=e/ot|0;for(t=t.slice();u--;)s=((i=c*(o=t[u]%ot)+(n=l*o+(a=t[u]/ot|0)*c)%ot*ot+s)/r|0)+(n/ot|0)+l*a,t[u]=i%r;return s&&(t=[s].concat(t)),t}function e(t,e,r,n){var i,o;if(r!=n)o=r>n?1:-1;else for(i=o=0;i<r;i++)if(t[i]!=e[i]){o=t[i]>e[i]?1:-1;break}return o}function r(t,e,r,n){for(var i=0;r--;)t[r]-=i,i=t[r]<e[r]?1:0,t[r]=i*n+t[r]-e[r];for(;!t[0]&&t.length>1;t.splice(0,1));}return function(n,i,o,a,s){var u,c,l,f,h,p,d,v,m,y,g,w,b,x,E,k,O,_=n.s==i.s?1:-1,A=n.c,T=i.c;if(!(A&&A[0]&&T&&T[0]))return new S(n.s&&i.s&&(A?!T||A[0]!=T[0]:T)?A&&0==A[0]||!T?0*_:_/0:NaN);for(m=(v=new S(_)).c=[],_=o+(c=n.e-i.e)+1,s||(s=et,c=st(n.e/rt)-st(i.e/rt),_=_/rt|0),l=0;T[l]==(A[l]||0);l++);if(T[l]>(A[l]||0)&&c--,_<0)m.push(1),f=!0;else{for(x=A.length,k=T.length,l=0,_+=2,(h=K(s/(T[0]+1)))>1&&(T=t(T,h,s),A=t(A,h,s),k=T.length,x=A.length),b=k,g=(y=A.slice(0,k)).length;g<k;y[g++]=0);O=T.slice(),O=[0].concat(O),E=T[0],T[1]>=s/2&&E++;do{if(h=0,(u=e(T,y,k,g))<0){if(w=y[0],k!=g&&(w=w*s+(y[1]||0)),(h=K(w/E))>1)for(h>=s&&(h=s-1),d=(p=t(T,h,s)).length,g=y.length;1==e(p,y,d,g);)h--,r(p,k<d?O:T,d,s),d=p.length,u=1;else 0==h&&(u=h=1),d=(p=T.slice()).length;if(d<g&&(p=[0].concat(p)),r(y,p,g,s),g=y.length,-1==u)for(;e(T,y,k,g)<1;)h++,r(y,k<g?O:T,g,s),g=y.length}else 0===u&&(h++,y=[0]);m[l++]=h,y[0]?y[g++]=A[b]||0:(y=[A[b]],g=1)}while((b++<x||null!=y[0])&&_--);f=null!=y[0],m[0]||m.splice(0,1)}if(s==et){for(l=1,_=m[0];_>=10;_/=10,l++);N(v,o+(v.e=l+c*rt-1)+1,a,f)}else v.e=c,v.r=+f;return v}}(),s=/^(-?)0([xbo])(?=\w[\w.]*$)/i,u=/^([^.]+)\.$/,c=/^\.([^.]+)$/,l=/^-?(Infinity|NaN)$/,f=/^\s*\+(?=[\w.])|^\s+|\s+$/g,i=function(t,e,r,n){var i,o=r?e:e.replace(f,"");if(l.test(o))t.s=isNaN(o)?null:o<0?-1:1;else{if(!r&&(o=o.replace(s,(function(t,e,r){return i="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=i?t:e})),n&&(i=n,o=o.replace(u,"$1").replace(c,"0.$1")),e!=o))return new S(o,i);if(S.DEBUG)throw Error(Z+"Not a"+(n?" base "+n:"")+" number: "+e);t.s=null}t.c=t.e=null},h.absoluteValue=h.abs=function(){var t=new S(this);return t.s<0&&(t.s=1),t},h.comparedTo=function(t,e){return ct(this,new S(t,e))},h.decimalPlaces=h.dp=function(t,e){var r,n,i,o=this;if(null!=t)return lt(t,0,at),null==e?e=v:lt(e,0,8),N(new S(o),t+o.e+1,e);if(!(r=o.c))return null;if(n=((i=r.length-1)-st(this.e/rt))*rt,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},h.dividedBy=h.div=function(t,e){return r(this,new S(t,e),d,v)},h.dividedToIntegerBy=h.idiv=function(t,e){return r(this,new S(t,e),0,1)},h.exponentiatedBy=h.pow=function(t,e){var r,n,i,o,a,s,u,c,l=this;if((t=new S(t)).c&&!t.isInteger())throw Error(Z+"Exponent not an integer: "+M(t));if(null!=e&&(e=new S(e)),a=t.e>14,!l.c||!l.c[0]||1==l.c[0]&&!l.e&&1==l.c.length||!t.c||!t.c[0])return c=new S(Math.pow(+M(l),a?2-ft(t):+M(t))),e?c.mod(e):c;if(s=t.s<0,e){if(e.c?!e.c[0]:!e.s)return new S(NaN);(n=!s&&l.isInteger()&&e.isInteger())&&(l=l.mod(e))}else{if(t.e>9&&(l.e>0||l.e<-1||(0==l.e?l.c[0]>1||a&&l.c[1]>=24e7:l.c[0]<8e13||a&&l.c[0]<=9999975e7)))return o=l.s<0&&ft(t)?-0:0,l.e>-1&&(o=1/o),new S(s?1/o:o);E&&(o=J(E/rt+2))}for(a?(r=new S(.5),s&&(t.s=1),u=ft(t)):u=(i=Math.abs(+M(t)))%2,c=new S(p);;){if(u){if(!(c=c.times(l)).c)break;o?c.c.length>o&&(c.c.length=o):n&&(c=c.mod(e))}if(i){if(0===(i=K(i/2)))break;u=i%2}else if(N(t=t.times(r),t.e+1,1),t.e>14)u=ft(t);else{if(0==(i=+M(t)))break;u=i%2}l=l.times(l),o?l.c&&l.c.length>o&&(l.c.length=o):n&&(l=l.mod(e))}return n?c:(s&&(c=p.div(c)),e?c.mod(e):o?N(c,E,v,void 0):c)},h.integerValue=function(t){var e=new S(this);return null==t?t=v:lt(t,0,8),N(e,e.e+1,t)},h.isEqualTo=h.eq=function(t,e){return 0===ct(this,new S(t,e))},h.isFinite=function(){return!!this.c},h.isGreaterThan=h.gt=function(t,e){return ct(this,new S(t,e))>0},h.isGreaterThanOrEqualTo=h.gte=function(t,e){return 1===(e=ct(this,new S(t,e)))||0===e},h.isInteger=function(){return!!this.c&&st(this.e/rt)>this.c.length-2},h.isLessThan=h.lt=function(t,e){return ct(this,new S(t,e))<0},h.isLessThanOrEqualTo=h.lte=function(t,e){return-1===(e=ct(this,new S(t,e)))||0===e},h.isNaN=function(){return!this.s},h.isNegative=function(){return this.s<0},h.isPositive=function(){return this.s>0},h.isZero=function(){return!!this.c&&0==this.c[0]},h.minus=function(t,e){var r,n,i,o,a=this,s=a.s;if(e=(t=new S(t,e)).s,!s||!e)return new S(NaN);if(s!=e)return t.s=-e,a.plus(t);var u=a.e/rt,c=t.e/rt,l=a.c,f=t.c;if(!u||!c){if(!l||!f)return l?(t.s=-e,t):new S(f?a:NaN);if(!l[0]||!f[0])return f[0]?(t.s=-e,t):new S(l[0]?a:3==v?-0:0)}if(u=st(u),c=st(c),l=l.slice(),s=u-c){for((o=s<0)?(s=-s,i=l):(c=u,i=f),i.reverse(),e=s;e--;i.push(0));i.reverse()}else for(n=(o=(s=l.length)<(e=f.length))?s:e,s=e=0;e<n;e++)if(l[e]!=f[e]){o=l[e]<f[e];break}if(o&&(i=l,l=f,f=i,t.s=-t.s),(e=(n=f.length)-(r=l.length))>0)for(;e--;l[r++]=0);for(e=et-1;n>s;){if(l[--n]<f[n]){for(r=n;r&&!l[--r];l[r]=e);--l[r],l[n]+=et}l[n]-=f[n]}for(;0==l[0];l.splice(0,1),--c);return l[0]?T(t,l,c):(t.s=3==v?-1:1,t.c=[t.e=0],t)},h.modulo=h.mod=function(t,e){var n,i,o=this;return t=new S(t,e),!o.c||!t.s||t.c&&!t.c[0]?new S(NaN):!t.c||o.c&&!o.c[0]?new S(o):(9==x?(i=t.s,t.s=1,n=r(o,t,0,3),t.s=i,n.s*=i):n=r(o,t,0,x),(t=o.minus(n.times(t))).c[0]||1!=x||(t.s=o.s),t)},h.multipliedBy=h.times=function(t,e){var r,n,i,o,a,s,u,c,l,f,h,p,d,v,m,y=this,g=y.c,w=(t=new S(t,e)).c;if(!(g&&w&&g[0]&&w[0]))return!y.s||!t.s||g&&!g[0]&&!w||w&&!w[0]&&!g?t.c=t.e=t.s=null:(t.s*=y.s,g&&w?(t.c=[0],t.e=0):t.c=t.e=null),t;for(n=st(y.e/rt)+st(t.e/rt),t.s*=y.s,(u=g.length)<(f=w.length)&&(d=g,g=w,w=d,i=u,u=f,f=i),i=u+f,d=[];i--;d.push(0));for(v=et,m=ot,i=f;--i>=0;){for(r=0,h=w[i]%m,p=w[i]/m|0,o=i+(a=u);o>i;)r=((c=h*(c=g[--a]%m)+(s=p*c+(l=g[a]/m|0)*h)%m*m+d[o]+r)/v|0)+(s/m|0)+p*l,d[o--]=c%v;d[o]=r}return r?++n:d.splice(0,1),T(t,d,n)},h.negated=function(){var t=new S(this);return t.s=-t.s||null,t},h.plus=function(t,e){var r,n=this,i=n.s;if(e=(t=new S(t,e)).s,!i||!e)return new S(NaN);if(i!=e)return t.s=-e,n.minus(t);var o=n.e/rt,a=t.e/rt,s=n.c,u=t.c;if(!o||!a){if(!s||!u)return new S(i/0);if(!s[0]||!u[0])return u[0]?t:new S(s[0]?n:0*i)}if(o=st(o),a=st(a),s=s.slice(),i=o-a){for(i>0?(a=o,r=u):(i=-i,r=s),r.reverse();i--;r.push(0));r.reverse()}for((i=s.length)-(e=u.length)<0&&(r=u,u=s,s=r,e=i),i=0;e;)i=(s[--e]=s[e]+u[e]+i)/et|0,s[e]=et===s[e]?0:s[e]%et;return i&&(s=[i].concat(s),++a),T(t,s,a)},h.precision=h.sd=function(t,e){var r,n,i,o=this;if(null!=t&&t!==!!t)return lt(t,1,at),null==e?e=v:lt(e,0,8),N(new S(o),t,e);if(!(r=o.c))return null;if(n=(i=r.length-1)*rt+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return t&&o.e+1>n&&(n=o.e+1),n},h.shiftedBy=function(t){return lt(t,-9007199254740991,nt),this.times("1e"+t)},h.squareRoot=h.sqrt=function(){var t,e,n,i,o,a=this,s=a.c,u=a.s,c=a.e,l=d+4,f=new S("0.5");if(1!==u||!s||!s[0])return new S(!u||u<0&&(!s||s[0])?NaN:s?a:1/0);if(0==(u=Math.sqrt(+M(a)))||u==1/0?(((e=ut(s)).length+c)%2==0&&(e+="0"),u=Math.sqrt(+e),c=st((c+1)/2)-(c<0||c%2),n=new S(e=u==1/0?"5e"+c:(e=u.toExponential()).slice(0,e.indexOf("e")+1)+c)):n=new S(u+""),n.c[0])for((u=(c=n.e)+l)<3&&(u=0);;)if(o=n,n=f.times(o.plus(r(a,o,l,1))),ut(o.c).slice(0,u)===(e=ut(n.c)).slice(0,u)){if(n.e<c&&--u,"9999"!=(e=e.slice(u-3,u+1))&&(i||"4999"!=e)){+e&&(+e.slice(1)||"5"!=e.charAt(0))||(N(n,n.e+d+2,1),t=!n.times(n).eq(a));break}if(!i&&(N(o,o.e+d+2,0),o.times(o).eq(a))){n=o;break}l+=4,u+=4,i=1}return N(n,n.e+d+1,v,t)},h.toExponential=function(t,e){return null!=t&&(lt(t,0,at),t++),_(this,t,e,1)},h.toFixed=function(t,e){return null!=t&&(lt(t,0,at),t=t+this.e+1),_(this,t,e)},h.toFormat=function(t,e,r){var n,i=this;if(null==r)null!=t&&e&&"object"==typeof e?(r=e,e=null):t&&"object"==typeof t?(r=t,t=e=null):r=k;else if("object"!=typeof r)throw Error(Z+"Argument not an object: "+r);if(n=i.toFixed(t,e),i.c){var o,a=n.split("."),s=+r.groupSize,u=+r.secondaryGroupSize,c=r.groupSeparator||"",l=a[0],f=a[1],h=i.s<0,p=h?l.slice(1):l,d=p.length;if(u&&(o=s,s=u,u=o,d-=o),s>0&&d>0){for(o=d%s||s,l=p.substr(0,o);o<d;o+=s)l+=c+p.substr(o,s);u>0&&(l+=c+p.slice(o)),h&&(l="-"+l)}n=f?l+(r.decimalSeparator||"")+((u=+r.fractionGroupSize)?f.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):f):l}return(r.prefix||"")+n+(r.suffix||"")},h.toFraction=function(t){var e,n,i,o,a,s,u,c,l,f,h,d,m=this,y=m.c;if(null!=t&&(!(u=new S(t)).isInteger()&&(u.c||1!==u.s)||u.lt(p)))throw Error(Z+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+M(u));if(!y)return new S(m);for(e=new S(p),l=n=new S(p),i=c=new S(p),d=ut(y),a=e.e=d.length-m.e-1,e.c[0]=it[(s=a%rt)<0?rt+s:s],t=!t||u.comparedTo(e)>0?a>0?e:l:u,s=w,w=1/0,u=new S(d),c.c[0]=0;f=r(u,e,0,1),1!=(o=n.plus(f.times(i))).comparedTo(t);)n=i,i=o,l=c.plus(f.times(o=l)),c=o,e=u.minus(f.times(o=e)),u=o;return o=r(t.minus(n),i,0,1),c=c.plus(o.times(l)),n=n.plus(o.times(i)),c.s=l.s=m.s,h=r(l,i,a*=2,v).minus(m).abs().comparedTo(r(c,n,a,v).minus(m).abs())<1?[l,i]:[c,n],w=s,h},h.toNumber=function(){return+M(this)},h.toPrecision=function(t,e){return null!=t&&lt(t,1,at),_(this,t,e,2)},h.toString=function(t){var e,r=this,i=r.s,o=r.e;return null===o?i?(e="Infinity",i<0&&(e="-"+e)):e="NaN":(null==t?e=o<=m||o>=y?ht(ut(r.c),o):pt(ut(r.c),o,"0"):10===t?e=pt(ut((r=N(new S(r),d+o+1,v)).c),r.e,"0"):(lt(t,2,O.length,"Base"),e=n(pt(ut(r.c),o,"0"),10,t,i,!0)),i<0&&r.c[0]&&(e="-"+e)),e},h.valueOf=h.toJSON=function(){return M(this)},h._isBigNumber=!0,h[Symbol.toStringTag]="BigNumber",h[Symbol.for("nodejs.util.inspect.custom")]=h.valueOf,null!=e&&S.set(e),S}();function vt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var gt=function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};vt(this,t),yt(this,"label",void 0),yt(this,"isBinary",void 0),yt(this,"isPrefix",void 0),yt(this,"precedence",void 0),yt(this,"updateContext",void 0),this.label=e,this.isBinary=!!n.isBinary,this.isPrefix=!!n.isPrefix,this.precedence=null!==(r=n.precedence)&&void 0!==r?r:-1},wt={start:new gt("start"),end:new gt("end"),parenL:new gt("("),parenR:new gt(")"),numeric:new gt("numeric"),identifier:new gt("identifier"),plus:new gt("+",{isBinary:!0,precedence:13}),minus:new gt("-",{isBinary:!0,precedence:13}),times:new gt("*",{isBinary:!0,precedence:14}),div:new gt("/",{isBinary:!0,precedence:14}),prefixPlus:new gt("+",{isPrefix:!0,precedence:16}),prefixMinus:new gt("-",{isPrefix:!0,precedence:16})};wt.parenL.updateContext=function(){this.allowPrefix=!0},wt.parenR.updateContext=function(){this.allowPrefix=!1},wt.numeric.updateContext=function(){this.allowPrefix=!1},wt.identifier.updateContext=function(){this.allowPrefix=!1};var bt=function t(e){vt(this,t),yt(this,"type",void 0),yt(this,"start",void 0),yt(this,"end",void 0),this.type="",this.start=e,this.end=e};function xt(t){return t>=48&&t<=57}function Et(t){return 46===t||xt(t)}function kt(t){return t>=65&&t<=90||t>=97&&t<=122}var Ot=["+","-","*","/","(",")"],St=[];function _t(t,e){if("string"!=typeof t||!/^\S+$/.test(t))throw new Error("The custom operator should be a non-empty string");if(Ot.includes(t))throw new Error("The custom operator cannot use reserved character, including: ".concat(Ot.join(", ")));if(Et(t.charCodeAt(0)))throw new Error("The custom operator cannot start with a possible number, including: `.`, 0-9");if(63===t.charCodeAt(0))throw new Error("The custom operator cannot start with `?`");if(null!=e&&("number"!=typeof e||e<0))throw new Error("The precedence should be a number greater than 0")}var At=function t(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];vt(this,t),yt(this,"value",void 0),yt(this,"codes",void 0),yt(this,"type",void 0),yt(this,"calc",void 0),this.value=e,this.codes=e.split("").map((function(t,r){return e.charCodeAt(r)})),this.type=new gt(e,{isBinary:!i,isPrefix:i,precedence:r}),this.calc=n},Tt={"+":function(t,e){return String(Number(t)+Number(e))},"-":function(t,e){return String(Number(t)-Number(e))},"*":function(t,e){return String(Number(t)*Number(e))},"/":function(t,e){return String(Number(t)/Number(e))}};function Nt(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t instanceof bt)switch(t.type){case"Expression":return Nt(t.expression,r);case"BinaryExpression":return function(t,e,r){switch(r){case"+":case"-":case"*":case"/":return Tt[r](t,e);default:for(var n=0;n<St.length;n++){var i=St[n];if(i.type.isBinary&&i.value===r)return i.calc(t,e)}}throw new Error("Unexpected binary operator: ".concat(r))}(Nt(t.left,r),Nt(t.right,r),t.operator);case"UnaryExpression":return function(t,e){switch(e){case"+":return t;case"-":return String(-t);default:for(var r=0;r<St.length;r++){var n=St[r];if(n.type.isPrefix&&n.value===e)return n.calc(t)}}throw new Error("Unexpected unary operator: ".concat(e))}(Nt(t.argument,r),t.operator);case"NumericLiteral":return t.value;case"Identifier":if(void 0===(e=r[t.name]))throw new Error("The scope name `".concat(t.name,"` is not initialized"));return String(e);default:throw new Error("Unexpected type: ".concat(t.type))}return t}var Mt=function(){function t(e){vt(this,t),yt(this,"input",void 0),yt(this,"node",void 0),yt(this,"pos",void 0),yt(this,"tokenType",void 0),yt(this,"value",void 0),yt(this,"start",void 0),yt(this,"end",void 0),yt(this,"lastTokenStart",void 0),yt(this,"lastTokenEnd",void 0),yt(this,"allowPrefix",void 0),this.input=String(e),this.tokenType=wt.start,this.value="",this.pos=0,this.start=0,this.end=0,this.lastTokenStart=0,this.lastTokenEnd=0,this.allowPrefix=!0}var e,r,n;return e=t,r=[{key:"compile",value:function(){var t=this.node;return void 0===t&&(t=this.parse()),function(e){return t?Nt(t,null!=e?e:{}):"0"}}},{key:"parse",value:function(){this.next();var t=this.startNode(this.start);return this.tokenType===wt.end?this.node=null:(t.expression=this.parseExpression(),this.tokenType!==wt.end&&this.unexpected(this.value),this.node=this.finishNode(t,"Expression"))}},{key:"parseExpression",value:function(){return this.parseExprAtom(this.start,-1)}},{key:"parseExprAtom",value:function(t,e){if(this.tokenType===wt.parenL){this.next();var r=this.parseExprAtom(this.start,-1);return this.expect(wt.parenR),this.parseExprOp(r,t,e)}var n=this.parseMaybeUnary(e);return this.parseExprOp(n,t,e)}},{key:"parseExprOp",value:function(t,e,r){var n=this.tokenType.precedence;if(this.tokenType.isBinary&&n>r){var i=this.startNode(e),o=this.value;this.next();var a=this.start,s=this.parseExprAtom(a,n),u=this.parseExprOp(s,a,n);return i.left=t,i.operator=o,i.right=u,this.finishNode(i,"BinaryExpression"),this.parseExprOp(i,e,r)}return t}},{key:"parseMaybeUnary",value:function(t){var e=this.tokenType.precedence,r=this.startNode(),n=this.start,i=this.value;if(this.tokenType.isPrefix&&e>=t)return r.operator=i,r.prefix=!0,this.next(),r.argument=this.parseExprAtom(this.start,e),this.finishNode(r,"UnaryExpression");if(this.tokenType===wt.numeric){var o=function(t){for(var e=t,r=[],n=0;n<e.length;n++)95!==e.charCodeAt(n)&&r.push(e[n]);return r.length!==e.length&&(e=r.join("")),e}(i);return r.rawValue=i,r.value=o,this.next(),this.finishNode(r,"NumericLiteral")}return this.tokenType===wt.identifier?(r.name=i,this.next(),this.finishNode(r,"Identifier")):this.unexpected(i,n)}},{key:"next",value:function(){if(this.lastTokenStart=this.start,this.lastTokenEnd=this.end,this.skipSpace(),this.start=this.pos,this.pos>=this.input.length){if(this.tokenType===wt.end)return;this.finishToken(wt.end)}else this.readToken()}},{key:"readToken",value:function(){return Et(this.codeAt(this.pos))?this.readNumeric():this.readTokenFromCode()}},{key:"readNumeric",value:function(){for(var t=this.pos,e=-1,r=!0,n=!1,i=!1,o=-1;this.isValidPosition();){var a=this.codeAt(this.pos);if(xt(a))-1===e&&(e=0),this.pos++,i=!1,n=!0;else{if(i){o=this.pos,i=!1;break}if(69===a||101===a){if(0!==e){o=this.pos;break}e++,this.pos++,!this.isValidPosition()||43!==this.codeAt(this.pos)&&45!==this.codeAt(this.pos)||this.pos++,r=!1,i=!0}else if(46===a){if(!r){o=this.pos;break}r=!1,this.pos++,this.pos-t==1&&(i=!0)}else{if(95!==a)break;if(!n){o=this.pos;break}n=!1,i=!0,this.pos++}}}i&&(o=this.pos-1),o>=0&&this.unexpected(this.input[o],o);var s=this.input.slice(t,this.pos);this.finishToken(wt.numeric,s)}},{key:"readTokenFromCode",value:function(){var t,e,r,n=this.codeAt(this.pos);for(e=0;e<St.length;e++){var i=St[e];for(r=0;r<i.codes.length&&i.codes[r]===this.codeAt(this.pos+r);r++);if(r===i.codes.length){t=i;break}}if(t)return this.pos+=t.codes.length,this.finishToken(t.type,t.value);switch(n){case 40:return this.pos++,this.finishToken(wt.parenL,"(");case 41:return this.pos++,this.finishToken(wt.parenR,")");case 42:return this.pos++,this.finishToken(wt.times,"*");case 43:return this.pos++,this.allowPrefix?this.finishToken(wt.prefixPlus,"+"):this.finishToken(wt.plus,"+");case 45:return this.pos++,this.allowPrefix?this.finishToken(wt.prefixMinus,"-"):this.finishToken(wt.minus,"-");case 47:return this.pos++,this.finishToken(wt.div,"/");default:if(kt(n))return this.readIdentifier()}this.unexpected(this.input[this.pos])}},{key:"readIdentifier",value:function(){for(var t=this.pos;this.isValidPosition()&&(kt(e=this.codeAt(this.pos))||xt(e)||95===e);)this.pos++;var e,r=this.input.slice(t,this.pos);this.finishToken(wt.identifier,r)}},{key:"finishToken",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this.tokenType;this.end=this.pos,this.tokenType=t,this.value=e,this.updateContext(r)}},{key:"updateContext",value:function(t){var e=this.tokenType;e.isBinary||e.isPrefix?this.allowPrefix=!0:e.updateContext&&e.updateContext.call(this,t)}},{key:"codeAt",value:function(t){return this.input.charCodeAt(t)}},{key:"isValidPosition",value:function(){return this.pos<this.input.length}},{key:"startNode",value:function(t){return new bt(null!=t?t:this.start)}},{key:"finishNode",value:function(t,e){return t.type=e,t.end=this.lastTokenEnd,t}},{key:"skipSpace",value:function(){for(;this.isValidPosition();){var t=this.codeAt(this.pos);if(32===t||160===t)this.pos++;else if(13===t||10===t||8232===t||8233===t)13===t&&10===this.codeAt(this.pos+1)&&this.pos++,this.pos++;else{if(!(t>8&&t<14))break;this.pos++}}}},{key:"expect",value:function(t){this.eat(t)||this.unexpected(this.value)}},{key:"eat",value:function(t){return this.tokenType===t&&(this.next(),!0)}},{key:"unexpected",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;this.raise(null!=e?e:this.start,"Unexpected token ".concat(t))}},{key:"raise",value:function(t,e){throw t>this.input.length-1?e="Unexpected end of input":e+=" at position ".concat(t),new SyntaxError(e)}}],n=[{key:"evaluate",value:function(e,r){return new t(e).compile()(r)}}],r&&mt(e.prototype,r),n&&mt(e,n),t}();yt(Mt,"createBinaryOperator",void 0),yt(Mt,"createUnaryOperator",void 0),yt(Mt,"useOperator",void 0),yt(Mt,"useAdapter",void 0),yt(Mt,"Node",bt),yt(Mt,"TokenType",gt),yt(Mt,"tokenTypes",wt),yt(Mt,"installedOperators",St);var $t=Mt.evaluate;Mt.createBinaryOperator=function(t,e,r){if(_t(t,e),"function"!=typeof r)throw new Error("Expected to receive a calculation method, like: `(left, right) => String(left - right)`");return new At(t,e,r,!1)},Mt.createUnaryOperator=function(t,e,r){if(_t(t,e),"function"!=typeof r)throw new Error("Expected to receive a calculation method, like: `(value) => String(Math.abs(value))`");return new At(t,e,r,!0)},Mt.useOperator=function(t){St.includes(t)||St.unshift(t)},Mt.useAdapter=function(t){t=t||{},["+","-","*","/"].forEach((function(e){if("function"!=typeof t[e])throw new Error("Missing method for calculation operator `".concat(e,"`"))})),Tt=t};var Lt={"+":function(t,e){return new dt(t).plus(e).toString()},"-":function(t,e){return new dt(t).minus(e).toString()},"*":function(t,e){return new dt(t).times(e).toString()},"/":function(t,e){return new dt(t).div(e).toString()}};function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}Mt.useAdapter(Lt);var Ct=function(){function t(t,e){this.humanize=void 0,this.conditionMap={},this.humanize=t,e&&(this.conditionMap=e)}var e=t.prototype;return e.load=function(){var t=o(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,H();case 2:this.conditionMap=t.sent;case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.parse=function(t,e){if(!this.conditionMap)return!1;for(var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Dt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Dt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t.matchAll(/\{([^\}]*)\}/gi));!(r=n()).done;){var i=r.value,o=this.conditionMap[i[1]];if(!o)return!1;var a=o.getTotal(e.calculate);e.span&&(a=o.getSpan(e.span,e.calculate)),t=t.replace(i[0],a+"")}try{return Math.floor(parseFloat($t(t)))}catch(t){return!1}},e.getValue=function(t){var e=this.humanize.getRawConditionDefinition(t.name);if(!e)return 0;if(!e.evaluation){var r=this.conditionMap[t.name];if(!r)return 0;var n=r.getTotal(t.calculate);return t.span&&(n=r.getSpan(t.span,t.calculate)),n}return this.parse(e.evaluation,t)||0},t}(),Pt=function(t){function r(){return t.apply(this,arguments)||this}x(r,t);var n=r.prototype;return n.view=function(t){var r=this,n=d.getInstance(e());return m("div",{className:"collector-condition"},m("div",{className:"collector-condition-title"},m("i",{class:"fas fa-tasks"})," ",e().translator.trans("xypp-collector.forum.condition.condition")),this.attrs.conditions.map((function(t){return m("div",{className:"collector-condition-line"},m("span",null,n.humanizeCondition(t)),r.progress(t,n))})))},n.progress=function(t,e){if(!this.attrs.conditionMap)return"";var r=new Ct(e,this.attrs.conditionMap).getValue(t);return this.conditionOp(r,t.operator,t.value)?m("span",{className:"collector-progress-satisfy"},"[",m("i",{class:"fas fa-check"}),"]"):m("span",{className:"collector-progress-not-satisfy"},"[",r,"/",t.value,"]")},n.conditionOp=function(t,e,r){switch(e){case c.EQUAL:return t==r;case c.GREATER_THAN:return t>r;case c.GREATER_THAN_OR_EQUAL:return t>=r;case c.LESS_THAN:return t<r;case c.LESS_THAN_OR_EQUAL:return t<=r;case c.NOT_EQUAL:return t!=r}},r}(Q()),Ut=function(t){function r(){return t.apply(this,arguments)||this}return x(r,t),r.prototype.view=function(t){var r=d.getInstance(e());return m("div",{className:"collector-reward"},m("div",{className:"collector-reward-title"},m("i",{class:"fas fa-gift"})," ",e().translator.trans("xypp-collector.forum.reward.reward")),r.humanizeReward(this.attrs.rewards).map((function(t){return m("div",null,t)})))},r}(Q());e().initializers.add("xypp/collector",(function(){var t,r;t=e(),r="xypp-collector."+"forum"+".integration",flarum.extensions["xypp-store"]&&function(t,e){var r={};g("store_item",(function(n){var i=t.store.getById("store-item",n);return i?i.attribute("name"):void 0===r[n]?(r[n]=!0,t.store.find("store-item",n).then((function(){m.redraw()})).catch((function(){r[n]=!1})),t.translator.trans(e+".reward.store_item_loading")+""):!1===r[n]?t.translator.trans(e+".reward.store_item_error")+"":t.translator.trans(e+".reward.store_item_loading")+""})),w("store_item",o(s().mark((function r(){var n,i;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.store.find("store-item");case 2:return n=r.sent,i=n.reduce((function(t,e){return t[e.id()]=e.attribute("name"),t}),{}),r.next=6,T.open(t,i,t.translator.trans(e+".reward.store_item_select"),t.translator.trans(e+".reward.store_item_select_button"));case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}}),r)}))))}(t,r),flarum.extensions["v17development-user-badges"]&&function(t,e){var r={};g("badge",(function(n){var i=t.store.getById("badges",n);return i?i.attribute("name"):void 0===r[n]?(r[n]=!0,t.store.find("badges",n).then((function(){m.redraw()})).catch((function(){r[n]=!1})),t.translator.trans(e+".reward.badge_loading")+""):!1===r[n]?t.translator.trans(e+".reward.badge_error")+"":t.translator.trans(e+".reward.badge_loading")+""})),w("badge",o(s().mark((function r(){var n,i;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.store.find("badges");case 2:return n=r.sent,i=n.reduce((function(t,e){return t[e.id()]=e.attribute("name"),t}),{}),r.next=6,T.open(t,i,t.translator.trans(e+".reward.badge_select"),t.translator.trans(e+".reward.badge_select_button"));case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}}),r)}))))}(t,r),(0,u.extend)(M().prototype,"show",(function(){var t,r,n,i,o,a;null!=(t=e().session)&&t.user&&(n="user_page_view",i=null==(r=this.user)?void 0:r.slug(),o=function(t){return r=function(t){return $(t,1)},D[e=t]=D[e]||0,void(D[e]<5&&(D[e]++,r(e)));var e,r},(a=C[n]=C[n]||{})[i]||(a[i]=!0,o(n)))}))}));const Rt=flarum.core.compat["common/extenders"];var jt=r.n(Rt),Bt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).name=U().attribute("name"),e.display_name=U().attribute("display_name"),e.evaluation=U().attribute("evaluation"),e}return x(e,t),e}(U());Bt.type="custom-condition";const It=[(new(jt().Store)).add("condition",Y).add(Bt.type,Bt)]})(),module.exports=n})();
//# sourceMappingURL=forum.js.map