/*! For license information please see admin.js.LICENSE.txt */
(()=>{var t={912:function(t){t.exports=function(){"use strict";var t=6e4,n=36e5,e="millisecond",r="second",a="minute",o="hour",i="day",s="week",c="month",u="quarter",l="year",d="date",m="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,h={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var n=["th","st","nd","rd"],e=t%100;return"["+t+(n[(e-20)%10]||n[e]||n[0])+"]"}},v=function(t,n,e){var r=String(t);return!r||r.length>=n?t:""+Array(n+1-r.length).join(e)+t},y={s:v,z:function(t){var n=-t.utcOffset(),e=Math.abs(n),r=Math.floor(e/60),a=e%60;return(n<=0?"+":"-")+v(r,2,"0")+":"+v(a,2,"0")},m:function t(n,e){if(n.date()<e.date())return-t(e,n);var r=12*(e.year()-n.year())+(e.month()-n.month()),a=n.clone().add(r,c),o=e-a<0,i=n.clone().add(r+(o?-1:1),c);return+(-(r+(e-a)/(o?a-i:i-a))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:c,y:l,w:s,d:i,D:d,h:o,m:a,s:r,ms:e,Q:u}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},g="en",b={};b[g]=h;var w="$isDayjsObject",x=function(t){return t instanceof S||!(!t||!t[w])},_=function t(n,e,r){var a;if(!n)return g;if("string"==typeof n){var o=n.toLowerCase();b[o]&&(a=o),e&&(b[o]=e,a=o);var i=n.split("-");if(!a&&i.length>1)return t(i[0])}else{var s=n.name;b[s]=n,a=s}return!r&&a&&(g=a),a||!r&&g},O=function(t,n){if(x(t))return t.clone();var e="object"==typeof n?n:{};return e.date=t,e.args=arguments,new S(e)},E=y;E.l=_,E.i=x,E.w=function(t,n){return O(t,{locale:n.$L,utc:n.$u,x:n.$x,$offset:n.$offset})};var S=function(){function h(t){this.$L=_(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[w]=!0}var v=h.prototype;return v.parse=function(t){this.$d=function(t){var n=t.date,e=t.utc;if(null===n)return new Date(NaN);if(E.u(n))return new Date;if(n instanceof Date)return new Date(n);if("string"==typeof n&&!/Z$/i.test(n)){var r=n.match(p);if(r){var a=r[2]-1||0,o=(r[7]||"0").substring(0,3);return e?new Date(Date.UTC(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)):new Date(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)}}return new Date(n)}(t),this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return E},v.isValid=function(){return!(this.$d.toString()===m)},v.isSame=function(t,n){var e=O(t);return this.startOf(n)<=e&&e<=this.endOf(n)},v.isAfter=function(t,n){return O(t)<this.startOf(n)},v.isBefore=function(t,n){return this.endOf(n)<O(t)},v.$g=function(t,n,e){return E.u(t)?this[n]:this.set(e,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,n){var e=this,u=!!E.u(n)||n,m=E.p(t),p=function(t,n){var r=E.w(e.$u?Date.UTC(e.$y,n,t):new Date(e.$y,n,t),e);return u?r:r.endOf(i)},f=function(t,n){return E.w(e.toDate()[t].apply(e.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(n)),e)},h=this.$W,v=this.$M,y=this.$D,g="set"+(this.$u?"UTC":"");switch(m){case l:return u?p(1,0):p(31,11);case c:return u?p(1,v):p(0,v+1);case s:var b=this.$locale().weekStart||0,w=(h<b?h+7:h)-b;return p(u?y-w:y+(6-w),v);case i:case d:return f(g+"Hours",0);case o:return f(g+"Minutes",1);case a:return f(g+"Seconds",2);case r:return f(g+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,n){var s,u=E.p(t),m="set"+(this.$u?"UTC":""),p=(s={},s[i]=m+"Date",s[d]=m+"Date",s[c]=m+"Month",s[l]=m+"FullYear",s[o]=m+"Hours",s[a]=m+"Minutes",s[r]=m+"Seconds",s[e]=m+"Milliseconds",s)[u],f=u===i?this.$D+(n-this.$W):n;if(u===c||u===l){var h=this.clone().set(d,1);h.$d[p](f),h.init(),this.$d=h.set(d,Math.min(this.$D,h.daysInMonth())).$d}else p&&this.$d[p](f);return this.init(),this},v.set=function(t,n){return this.clone().$set(t,n)},v.get=function(t){return this[E.p(t)]()},v.add=function(e,u){var d,m=this;e=Number(e);var p=E.p(u),f=function(t){var n=O(m);return E.w(n.date(n.date()+Math.round(t*e)),m)};if(p===c)return this.set(c,this.$M+e);if(p===l)return this.set(l,this.$y+e);if(p===i)return f(1);if(p===s)return f(7);var h=(d={},d[a]=t,d[o]=n,d[r]=1e3,d)[p]||1,v=this.$d.getTime()+e*h;return E.w(v,this)},v.subtract=function(t,n){return this.add(-1*t,n)},v.format=function(t){var n=this,e=this.$locale();if(!this.isValid())return e.invalidDate||m;var r=t||"YYYY-MM-DDTHH:mm:ssZ",a=E.z(this),o=this.$H,i=this.$m,s=this.$M,c=e.weekdays,u=e.months,l=e.meridiem,d=function(t,e,a,o){return t&&(t[e]||t(n,r))||a[e].slice(0,o)},p=function(t){return E.s(o%12||12,t,"0")},h=l||function(t,n,e){var r=t<12?"AM":"PM";return e?r.toLowerCase():r};return r.replace(f,(function(t,r){return r||function(t){switch(t){case"YY":return String(n.$y).slice(-2);case"YYYY":return E.s(n.$y,4,"0");case"M":return s+1;case"MM":return E.s(s+1,2,"0");case"MMM":return d(e.monthsShort,s,u,3);case"MMMM":return d(u,s);case"D":return n.$D;case"DD":return E.s(n.$D,2,"0");case"d":return String(n.$W);case"dd":return d(e.weekdaysMin,n.$W,c,2);case"ddd":return d(e.weekdaysShort,n.$W,c,3);case"dddd":return c[n.$W];case"H":return String(o);case"HH":return E.s(o,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return h(o,i,!0);case"A":return h(o,i,!1);case"m":return String(i);case"mm":return E.s(i,2,"0");case"s":return String(n.$s);case"ss":return E.s(n.$s,2,"0");case"SSS":return E.s(n.$ms,3,"0");case"Z":return a}return null}(t)||a.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(e,d,m){var p,f=this,h=E.p(d),v=O(e),y=(v.utcOffset()-this.utcOffset())*t,g=this-v,b=function(){return E.m(f,v)};switch(h){case l:p=b()/12;break;case c:p=b();break;case u:p=b()/3;break;case s:p=(g-y)/6048e5;break;case i:p=(g-y)/864e5;break;case o:p=g/n;break;case a:p=g/t;break;case r:p=g/1e3;break;default:p=g}return m?p:E.a(p)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return b[this.$L]},v.locale=function(t,n){if(!t)return this.$L;var e=this.clone(),r=_(t,n,!0);return r&&(e.$L=r),e},v.clone=function(){return E.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},h}(),N=S.prototype;return O.prototype=N,[["$ms",e],["$s",r],["$m",a],["$H",o],["$W",i],["$M",c],["$y",l],["$D",d]].forEach((function(t){N[t[1]]=function(n){return this.$g(n,t[0],t[1])}})),O.extend=function(t,n){return t.$i||(t(n,S,O),t.$i=!0),O},O.locale=_,O.isDayjs=x,O.unix=function(t){return O(1e3*t)},O.en=b[g],O.Ls=b,O.p={},O}()},24:(t,n,e)=>{var r=e(735).default;function a(){"use strict";t.exports=a=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var n,e={},o=Object.prototype,i=o.hasOwnProperty,s=Object.defineProperty||function(t,n,e){t[n]=e.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",d=c.toStringTag||"@@toStringTag";function m(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{m({},"")}catch(n){m=function(t,n,e){return t[n]=e}}function p(t,n,e,r){var a=n&&n.prototype instanceof w?n:w,o=Object.create(a.prototype),i=new $(r||[]);return s(o,"_invoke",{value:M(t,e,i)}),o}function f(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}e.wrap=p;var h="suspendedStart",v="suspendedYield",y="executing",g="completed",b={};function w(){}function x(){}function _(){}var O={};m(O,u,(function(){return this}));var E=Object.getPrototypeOf,S=E&&E(E(j([])));S&&S!==o&&i.call(S,u)&&(O=S);var N=_.prototype=w.prototype=Object.create(O);function A(t){["next","throw","return"].forEach((function(n){m(t,n,(function(t){return this._invoke(n,t)}))}))}function C(t,n){function e(a,o,s,c){var u=f(t[a],t,o);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==r(d)&&i.call(d,"__await")?n.resolve(d.__await).then((function(t){e("next",t,s,c)}),(function(t){e("throw",t,s,c)})):n.resolve(d).then((function(t){l.value=t,s(l)}),(function(t){return e("throw",t,s,c)}))}c(u.arg)}var a;s(this,"_invoke",{value:function(t,r){function o(){return new n((function(n,a){e(t,r,n,a)}))}return a=a?a.then(o,o):o()}})}function M(t,e,r){var a=h;return function(o,i){if(a===y)throw Error("Generator is already running");if(a===g){if("throw"===o)throw i;return{value:n,done:!0}}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var c=k(s,r);if(c){if(c===b)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===h)throw a=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=y;var u=f(t,e,r);if("normal"===u.type){if(a=r.done?g:v,u.arg===b)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(a=g,r.method="throw",r.arg=u.arg)}}}function k(t,e){var r=e.method,a=t.iterator[r];if(a===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=n,k(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var o=f(a,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,b;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,b):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,b)}function D(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function T(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function $(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(D,this),this.reset(!0)}function j(t){if(t||""===t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function e(){for(;++a<t.length;)if(i.call(t,a))return e.value=t[a],e.done=!1,e;return e.value=n,e.done=!0,e};return o.next=o}}throw new TypeError(r(t)+" is not iterable")}return x.prototype=_,s(N,"constructor",{value:_,configurable:!0}),s(_,"constructor",{value:x,configurable:!0}),x.displayName=m(_,d,"GeneratorFunction"),e.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===x||"GeneratorFunction"===(n.displayName||n.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,m(t,d,"GeneratorFunction")),t.prototype=Object.create(N),t},e.awrap=function(t){return{__await:t}},A(C.prototype),m(C.prototype,l,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var i=new C(p(t,n,r,a),o);return e.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},A(N),m(N,d,"Generator"),m(N,u,(function(){return this})),m(N,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var n=Object(t),e=[];for(var r in n)e.push(r);return e.reverse(),function t(){for(;e.length;){var r=e.pop();if(r in n)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,$.prototype={constructor:$,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,a){return s.type="throw",s.arg=t,e.next=r,a&&(e.method="next",e.arg=n),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=n,a?(this.method="next",this.next=a.finallyLoc,b):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),b},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),T(e),b}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.tryLoc===t){var r=e.completion;if("throw"===r.type){var a=r.arg;T(e)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=n),b}},e}t.exports=a,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,n,e)=>{var r=e(24)();t.exports=r;try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},n={};function e(r){var a=n[r];if(void 0!==a)return a.exports;var o=n[r]={exports:{}};return t[r].call(o.exports,o,o.exports,e),o.exports}e.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},e.d=(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{"use strict";e.r(r),e.d(r,{CALCULATE:()=>l,Condition:()=>L,ConditionConfigure:()=>B,HumanizeUtils:()=>h,OPERATOR:()=>u,RewardConfigure:()=>F,addCondition:()=>v,addReward:()=>y,addRewardSelection:()=>b,extend:()=>rt,rewardValueConvert:()=>g});const t=flarum.core.compat["admin/app"];var n=e.n(t);function a(t,n,e,r,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void e(t)}s.done?n(c):Promise.resolve(c).then(r,a)}function o(t){return function(){var n=this,e=arguments;return new Promise((function(r,o){var i=t.apply(n,e);function s(t){a(i,r,o,s,c,"next",t)}function c(t){a(i,r,o,s,c,"throw",t)}s(void 0)}))}}var i=e(183),s=e.n(i);const c=flarum.core.compat["common/extend"];var u=function(t){return t.EQUAL="=",t.NOT_EQUAL="!=",t.GREATER_THAN=">",t.LESS_THAN="<",t.GREATER_THAN_OR_EQUAL=">=",t.LESS_THAN_OR_EQUAL="<=",t}({}),l=function(t){return t[t.SUM=1]="SUM",t[t.MAX=2]="MAX",t[t.DAY_COUNT=3]="DAY_COUNT",t}({});const d=flarum.core.compat["common/utils/ItemList"];var p=e.n(d),f={">=":"ge",">":"gt","<=":"le","<":"lt","=":"eq","!=":"ne"},h=function(){function t(t){this.app=void 0,this.definitionLoaded=!1,this.rawConditionDefinition={},this.conditionTranslations={},this.rewardTranslations={},this.conditionsKeys=[],this.rewardsKeys=[],this.app=t}var n=t.prototype;return n.loadDefinition=function(){var t=o(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.definitionLoaded){t.next=2;break}return t.abrupt("return");case 2:if(!this.app.data["collector-definition"]){t.next=5;break}return this._loadDefinition(this.app.data["collector-definition"]),t.abrupt("return");case 5:return t.next=7,this.app.request({method:"GET",url:this.app.forum.attribute("apiUrl")+"/collector-data"});case 7:n=t.sent,this._loadDefinition(n);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n._loadDefinition=function(t){var n=this;t.conditions.forEach((function(t){n.conditionTranslations[t.key]=t.trans,n.conditionsKeys.push(t.key),n.rawConditionDefinition[t.key]=t})),t.rewards.forEach((function(t){n.rewardTranslations[t.key]=t.trans,n.rewardsKeys.push(t.key)})),this.definitionLoaded=!0},t.getInstance=function(n){return this.instance||(this.instance=new t(n)),this.instance},n.getAllConditions=function(t){var n=this;void 0===t&&(t=!1);var e=new(p());return this.conditionsKeys.forEach((function(r){!t&&n.rawConditionDefinition[r].global||e.add(r,n.conditionTranslations[r])})),e},n.getAllRewards=function(){var t=this,n=new(p());return this.rewardsKeys.forEach((function(e){n.add(e,t.rewardTranslations[e])})),n},n.getConditionName=function(t){return this.getAllConditions().has(t)?this.getAllConditions().get(t):t},n.getRewardName=function(t){return this.getAllRewards().has(t)?this.getAllRewards().get(t):t},n.getRewardValue=function(t,n){return n},n.rewardSelection=function(){var t=o(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return","");case 1:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),n.humanizeCondition=function(t){var n=this;if(Array.isArray(t))return t.map((function(t){return n.humanizeCondition(t)}));if(t.alter_name)return t.alter_name;var e=t.span?this.app.translator.trans("xypp-collector.forum.condition.span",{span:t.span}):"";return Array.isArray(e)&&(e=e.join("")),this.app.translator.trans("xypp-collector.forum.condition.format",{b:m("b",null),name:this.getConditionName(t.name),operator:this.app.translator.trans("xypp-collector.lib.operator."+f[t.operator]),value:t.value,calculate:this.getCalculate(t.calculate||l.SUM),span:e})},n.humanizeReward=function(t){var n=this;return Array.isArray(t)?t.map((function(t){return n.humanizeReward(t)})):t.alter_name?t.alter_name:this.app.translator.trans("xypp-collector.forum.reward.format",{b:m("b",null),name:this.getRewardName(t.name),value:this.getRewardValue(t.name,t.value)})},n.getCalculate=function(t){var n,e=((n={})[l.SUM]="sum",n[l.MAX]="max",n[l.DAY_COUNT]="days",n);return this.app.translator.trans("xypp-collector.lib.calculate."+e[t])},n.getRawConditionDefinition=function(t){return this.rawConditionDefinition[t]||!1},t}();function v(t,n){(0,c.extend)(h.prototype,"getAllConditions",(function(e){e.add(t,n)}))}function y(t,n){(0,c.extend)(h.prototype,"getAllRewards",(function(e){e.add(t,n)}))}function g(t,n){(0,c.override)(h.prototype,"getRewardValue",(function(e,r,a){return t===r?n(a):e(r,a)}))}function b(t,n){(0,c.override)(h.prototype,"rewardSelection",function(){var e=o(s().mark((function e(r,a){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==a){e.next=4;break}return e.abrupt("return",n());case 4:return e.abrupt("return",r(a));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function w(t,n){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},w(t,n)}function x(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,w(t,n)}h.instance=void 0;const _=flarum.core.compat["common/components/Modal"];var O=e.n(_);const E=flarum.core.compat["common/components/Button"];var S=e.n(E);const N=flarum.core.compat["common/components/Select"];var A=e.n(N),C=function(t){function n(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(n=t.call.apply(t,[this].concat(r))||this).selection="",n.done=!1,n}x(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.selection=this.attrs.items[Object.keys(this.attrs.items)[0]]},e.className=function(){return"Modal"},e.title=function(){return this.attrs.title},e.oncreate=function(n){t.prototype.oncreate.call(this,n)},e.onremove=function(n){t.prototype.onremove.call(this,n),this.done||this.attrs.cancel()},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m(A(),{className:"FormControl",value:this.selection,options:this.attrs.items,onchange:function(n){t.selection=n}.bind(this)})),m("div",{className:"Form-group"},m(S(),{class:"Button Button--primary",type:"submit",loading:this.loading},this.attrs.button))))},e.onsubmit=function(){var t=o(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),this.done=!0,this.attrs.callback(this.selection);case 3:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}(),n.open=function(t,e,r,a){return new Promise((function(o,i){t.modal.show(n,{items:e,title:r,button:a,cancel:function(){i()},callback:function(n){o(n),t.modal.close()}},!0)}))},n}(O());const M=flarum.core.compat["common/Model"];var k=e.n(M),D=e(912),T=e.n(D);function $(t){if(!t)return null;try{return JSON.parse(t)}catch(t){return null}}var j=["all","rest","flg","max","days"],L=function(t){function n(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(n=t.call.apply(t,[this].concat(r))||this).name=k().attribute("name"),n.value=k().attribute("value"),n.user_id=k().attribute("user_id"),n.global=k().attribute("global"),n.accumulation=k().attribute("accumulation",$),n}x(n,t);var e=n.prototype;return e.getSpan=function(t,n){void 0===n&&(n=l.SUM),n||(n=l.SUM);var e=this.accumulation();if(!e||t<1)return 0;var r=T()(T()().format("YYYYMMDD"),"YYYYMMDD");1!=t&&(r=r.subtract(t-1,"day"));var a=0;return Object.keys(e).forEach((function(t){if(!j.includes(t)){var o=T()(t,"YYYYMMDD");(o.isAfter(r)||o.isSame(r))&&(n==l.MAX?a=Math.max(a,e[t]):n==l.SUM?a+=e[t]:n==l.DAY_COUNT&&e[t]>0&&(a+=1))}})),a},e.getTotal=function(t){var n,e,r;return void 0===t&&(t=l.SUM),t||(t=l.SUM),t==l.MAX?(null==(n=this.accumulation())?void 0:n.max)||0:t==l.DAY_COUNT?(null==(e=this.accumulation())?void 0:e.days)||0:(null==(r=this.accumulation())?void 0:r.all)||0},n}(k());const R=flarum.core.compat["common/Component"];var U=e.n(R);function I(t,n,e){return t?n:e||""}function Y(t){return"*"!==t.name}var F=function(t){function e(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(n=t.call.apply(t,[this].concat(r))||this).rewards=[],n.REG_REWARDS={},n.rewardGettingValue={},n}x(e,t);var r=e.prototype;return r.oninit=function(e){var r=this;t.prototype.oninit.call(this,e);var a=h.getInstance(n()).getAllRewards().toObject();Object.keys(a).forEach((function(t){r.REG_REWARDS[t]=a[t].content})),this.REG_REWARDS["*"]=n().translator.trans("xypp-collector.admin.list.new_item")+"",this.rewards=JSON.parse(JSON.stringify(this.attrs.rewards())),this.rewards.push({name:"*",value:"*"})},r.onbeforeupdate=function(n){this.rewards=JSON.parse(JSON.stringify(this.attrs.rewards())),this.rewards.push({name:"*",value:"*"}),t.prototype.onbeforeupdate.call(this,n)},r.view=function(t){var e=this;return m("table",{className:"Table"},m("thead",null,m("tr",null,m("th",null,n().translator.trans("xypp-collector.admin.list.reward-name")),m("th",null,n().translator.trans("xypp-collector.admin.list.reward-value")),m("th",null,n().translator.trans("xypp-collector.admin.list.reward-get_value")),m("th",null,n().translator.trans("xypp-collector.admin.list.reward-alter_name")))),m("tbody",null,this.rewards.map((function(t,n){return m("tr",null,m("td",null,m(A(),{className:"FormControl",value:t.name,options:e.REG_REWARDS,onchange:function(t){e.rewards.length==n+1&&e.rewards.push({name:"*",value:"*"}),e.rewards[n].name=t,e.attrs.rewards(e.rewards.filter(Y))}.bind(e)})),m("td",null,m("input",{className:"FormControl",type:"text",value:t.value,onchange:function(t){e.rewards[n].value=t.target.value,e.attrs.rewards(e.rewards.filter(Y))}.bind(e)})),m("td",null,m(S(),{className:"Button Button--primary",onclick:e.getValue.bind(e),"data-id":n,disabled:e.rewardGettingValue[n],loading:e.rewardGettingValue[n]},m("i",{class:"fas fa-eye"}))),m("td",null,m("input",{className:"FormControl",type:"text",value:t.alter_name||"",onchange:function(t){e.rewards[n].alter_name=t.target.value||void 0,e.attrs.rewards(e.rewards.filter(Y))}.bind(e)})),m("td",null,I("*"!=t.name,m(S(),{className:"Button Button--danger",onclick:function(t){e.rewards.splice(n,1),e.attrs.rewards(e.rewards.filter(Y)),m.redraw()}.bind(e),"data-id":n},m("i",{class:"fas fa-trash"})))))}))))},r.getValue=function(){var t=o(s().mark((function t(e){var r,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=parseInt(e.currentTarget.getAttribute("data-id")),this.rewardGettingValue[r]=!0,m.redraw(),t.next=5,h.getInstance(n()).rewardSelection(this.rewards[r].name);case 5:(a=t.sent)&&(this.rewards[r].value=a),this.rewardGettingValue[r]=!1,this.attrs.rewards(this.rewards.filter(Y)),m.redraw();case 10:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}(),e}(U());function G(t){return"*"!==t.name}var B=function(t){function e(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(n=t.call.apply(t,[this].concat(r))||this).conditions=[],n.REG_OPERATOR={"=":"=",">":">",">=":">=","<":"<","<=":"<=","!=":"!="},n.REG_CALCULATE={},n.REG_CONDITIONS={},n}x(e,t);var r=e.prototype;return r.oninit=function(e){var r=this;t.prototype.oninit.call(this,e);var a=h.getInstance(n()),o=a.getAllConditions().toObject();Object.keys(o).forEach((function(t){r.REG_CONDITIONS[t]=o[t].content})),this.REG_CONDITIONS["*"]=n().translator.trans("xypp-collector.admin.list.new_item")+"",this.REG_CALCULATE[l.SUM]=a.getCalculate(l.SUM)+"",this.REG_CALCULATE[l.MAX]=a.getCalculate(l.MAX)+"",this.REG_CALCULATE[l.DAY_COUNT]=a.getCalculate(l.DAY_COUNT)+"",this.conditions=JSON.parse(JSON.stringify(this.attrs.conditions())),this.conditions.push({name:"*",operator:u.EQUAL,value:0})},r.onbeforeupdate=function(n){this.conditions=JSON.parse(JSON.stringify(this.attrs.conditions())),this.conditions.push({name:"*",operator:u.EQUAL,value:0}),t.prototype.onbeforeupdate.call(this,n)},r.view=function(t){var e=this;return m("table",{className:"Table condition-table"},m("thead",null,m("tr",null,m("th",null,n().translator.trans("xypp-collector.admin.list.condition-name")),m("th",null,n().translator.trans("xypp-collector.admin.list.condition-operator")),m("th",null,n().translator.trans("xypp-collector.admin.list.condition-value")),m("th",null,n().translator.trans("xypp-collector.admin.list.condition-span")),m("th",null,n().translator.trans("xypp-collector.admin.list.condition-calculate")),m("th",null,n().translator.trans("xypp-collector.admin.list.condition-alter_name")),m("th",null))),m("tbody",null,this.conditions.map((function(t,n){return m("tr",null,m("td",null,m(A(),{className:"FormControl",value:t.name,options:e.REG_CONDITIONS,onchange:function(t){e.conditions.length==n+1&&e.conditions.push({name:"*",operator:u.EQUAL,value:0}),e.conditions[n].name=t,e.attrs.conditions(e.conditions.filter(G))}.bind(e)})),m("td",null,m(A(),{className:"FormControl",value:t.operator,options:e.REG_OPERATOR,onchange:function(t){e.conditions[n].operator=t,e.attrs.conditions(e.conditions.filter(G))}.bind(e)})),m("td",null,m("input",{className:"FormControl",type:"text",value:t.value,onchange:function(t){e.conditions[n].value=parseInt(t.target.value),e.attrs.conditions(e.conditions.filter(G))}.bind(e)})),m("td",null,m("input",{className:"FormControl",type:"number",value:t.span,onchange:function(t){e.conditions[n].span=t.target.value?parseInt(t.target.value):void 0,e.attrs.conditions(e.conditions.filter(G))}.bind(e)})),m("td",null,m(A(),{className:"FormControl",value:t.calculate||l.SUM,options:e.REG_CALCULATE,onchange:function(t){e.conditions[n].calculate=parseInt(t),e.attrs.conditions(e.conditions.filter(G))}.bind(e)})),m("td",null,m("input",{className:"FormControl",type:"text",value:t.alter_name||"",onchange:function(t){e.conditions[n].alter_name=t.target.value||void 0,e.attrs.conditions(e.conditions.filter(G))}.bind(e)})),m("td",null,I("*"!=t.name,m(S(),{className:"Button Button--danger",onclick:function(t){e.conditions.splice(n,1),m.redraw(),e.attrs.conditions(e.conditions.filter(G))}.bind(e),"data-id":n},m("i",{class:"fas fa-trash"}))),I(e.conditions[n-1]&&"*"!=t.name,m(S(),{className:"Button Button--secondary",onclick:e.swap(n,-1)},m("i",{class:"fas fa-sort-up"}))),I(e.conditions[n+2]&&"*"!=t.name,m(S(),{className:"Button Button--secondary",onclick:e.swap(n,1)},m("i",{class:"fas fa-sort-down"})))))}))))},r.swap=function(t,n){var e=this;return function(){var r=Math.max(t+n,t),a=Math.min(t+n,t),o=e.conditions[r];e.conditions[r]=e.conditions[a],e.conditions[a]=o,e.attrs.conditions(e.conditions.filter(G)),m.redraw()}.bind(this)},e}(U());const P=flarum.core.compat["admin/components/ExtensionPage"];var J=e.n(P);const V=flarum.core.compat["common/components/LoadingIndicator"];var H=e.n(V);const W=flarum.core.compat["common/components/Checkbox"];var z=e.n(W);const Q=flarum.core.compat["common/components/LinkButton"];var X=e.n(Q);const q=flarum.core.compat["common/components/Tooltip"];var K=e.n(q),Z=function(t){function n(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(n=t.call.apply(t,[this].concat(r))||this).name=k().attribute("name"),n.display_name=k().attribute("display_name"),n.evaluation=k().attribute("evaluation"),n}return x(n,t),n}(k());Z.type="custom-condition";var tt=function(t){function e(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(n=t.call.apply(t,[this].concat(r))||this).name="",n.display_name="",n.evaluation="",n}x(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),h.getInstance(n()),this.attrs.item&&(this.name=this.attrs.item.name(),this.display_name=this.attrs.item.display_name(),this.evaluation=this.attrs.item.evaluation())},r.className=function(){return"Modal Modal--large"},r.title=function(){return n().translator.trans("xypp-collector.admin.custom.title")},r.oncreate=function(n){t.prototype.oncreate.call(this,n)},r.content=function(){var t=this,e=h.getInstance(n());return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",{for:"xypp-collector-custom-ipt-name"},n().translator.trans("xypp-collector.admin.custom.name")),m("input",{id:"xypp-collector-custom-ipt-name",required:!0,className:"FormControl",type:"text",step:"any",value:this.name,onchange:function(n){t.name=n.target.value}.bind(this)})),m("div",{className:"Form-group"},m("label",{for:"xypp-collector-custom-ipt-display_name"},n().translator.trans("xypp-collector.admin.custom.display_name")),m("input",{id:"xypp-collector-custom-ipt-display_name",required:!0,className:"FormControl",type:"text",step:"any",value:this.display_name,onchange:function(n){t.display_name=n.target.value}.bind(this)})),m("div",{className:"Form-group"},m("label",{for:"xypp-collector-custom-ipt-evaluation"},n().translator.trans("xypp-collector.admin.custom.evaluation")),m("textarea",{id:"xypp-collector-custom-ipt-evaluation",required:!0,className:"FormControl",step:"any",value:this.evaluation,onchange:function(n){t.evaluation=n.target.value}.bind(this)},this.evaluation)),m("div",{className:"Form-group"},m(S(),{class:"Button Button--primary",type:"submit",loading:this.loading},I(!!this.attrs.item,n().translator.trans("xypp-collector.admin.custom.button-edit"),n().translator.trans("xypp-collector.admin.custom.button")))),m("pre",null,Object.keys(e.getAllConditions(!0).toObject()).map((function(t){return e.getConditionName(t)+": {"+t+"}"})).join("\n"))))},r.onsubmit=function(){var t=o(s().mark((function t(e){var r,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),this.loading=!0,m.redraw(),r=this.attrs.item||n().store.createRecord(Z.type),t.prev=4,t.next=7,r.save({name:this.name,display_name:this.display_name,evaluation:this.evaluation});case 7:a=t.sent,this.attrs.update&&this.attrs.update(a),n().modal.close();case 10:return t.prev=10,this.loading=!1,m.redraw(),t.finish(10);case 14:case"end":return t.stop()}}),t,this,[[4,,10,14]])})));return function(n){return t.apply(this,arguments)}}(),e}(O()),nt=function(t){function e(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(n=t.call.apply(t,[this].concat(r))||this).loadingData=!1,n.autoEmit=void 0,n.autoEmitObj={},n.invalidTags=void 0,n.invalidTagsObj={},n.customs=void 0,n.deletingCustom={},n}x(e,t);var r=e.prototype;return r.oncreate=function(n){this.autoEmit=this.setting("xypp.collector.emit_control","{}"),this.autoEmitObj=JSON.parse(this.autoEmit()),Array.isArray(this.autoEmitObj)&&(this.autoEmitObj={}),this.invalidTags=this.setting("xypp.collector.invalid_tags","{}"),this.invalidTagsObj=JSON.parse(this.invalidTags()),Array.isArray(this.invalidTagsObj)&&(this.invalidTagsObj={}),t.prototype.oncreate.call(this,n),this.loadData()},r.content=function(t){var e,r=this;return m("div",{className:"xypp-collector-adminPage-container container"},m("div",{className:"Form-group"},m("h2",null,n().translator.trans("xypp-collector.admin.emit_control.title")),m("table",{className:"Table"},m("thead",null,m("tr",null,m("th",null,n().translator.trans("xypp-collector.admin.emit_control.name")),m("th",null,m(X(),{onclick:this.toggleAll("event")},n().translator.trans("xypp-collector.admin.emit_control.event"))),m("th",null,m(X(),{onclick:this.toggleAll("update")},n().translator.trans("xypp-collector.admin.emit_control.update"))),m("th",null,m(X(),{onclick:this.toggleAll("manual")},n().translator.trans("xypp-collector.admin.emit_control.manual"))),m("th",null,m(X(),{onclick:this.toggleAll("abs")},n().translator.trans("xypp-collector.admin.emit_control.abs"))))),m("tbody",null,this.getControls()))),I(this.loadingData,m(H(),null)),this.submitButton(),m("div",{className:"Form-group valid-tags"},m("h3",null,n().translator.trans("xypp-collector.admin.valid_tag")),m("div",{className:"xypp-collector-valid-tags-check"},this.getValidTags())),this.buildSettingComponent({setting:"xypp.collector.max_keep",label:n().translator.trans("xypp-collector.admin.max_keep"),type:"number",min:1}),this.buildSettingComponent({setting:"xypp.collector.use_custom",label:n().translator.trans("xypp-collector.admin.use_custom"),type:"boolean"}),this.buildSettingComponent({setting:"xypp.collector.custom-normal-update",label:n().translator.trans("xypp-collector.admin.custom_normal_update"),type:"boolean"}),this.buildSettingComponent({setting:"xypp.collector.custom-global-update",label:n().translator.trans("xypp-collector.admin.custom_global_update"),type:"boolean"}),this.buildSettingComponent({setting:"xypp.collector.auto_update",label:n().translator.trans("xypp-collector.admin.auto_update"),type:"boolean"}),this.buildSettingComponent({setting:"xypp.collector.auto_update_hour",label:n().translator.trans("xypp-collector.admin.auto_update_hour"),type:"number"}),this.submitButton(),m("div",null,m("h2",null,n().translator.trans("xypp-collector.admin.custom.title")),m("table",null,m("thead",null,m("tr",null,m("th",null,n().translator.trans("xypp-collector.admin.custom.name")),m("th",null))),m("tbody",null,null==(e=this.customs)?void 0:e.map((function(t){return m("tr",{className:"custom-row"},m("td",null,t.display_name()),m("td",null,m(S(),{className:"Button Button--primary",onclick:r.customEdit(t)},m("i",{class:"fas fa-edit"})),m(S(),{className:"Button Button--primary",onclick:r.customDelete(t)},m("i",{class:"fas fa-trash-alt"}))))})),m("tr",null,m("td",{colspan:"2"},m(S(),{className:"Button Button--primary",onclick:this.customAdd()},m("i",{class:"fas fa-plus"}),n().translator.trans("xypp-collector.admin.custom.add"))))))))},r.loadData=function(){var t=o(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadingData=!0,m.redraw(),t.next=4,h.getInstance(n()).loadDefinition();case 4:return t.next=6,n().store.find(Z.type);case 6:this.customs=t.sent,this.loadingData=!1,m.redraw();case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.getControls=function(){var t=this;if(this.loadingData)return[];var e=h.getInstance(n()).getAllConditions(!0).toObject();return Object.keys(e).map((function(r){return m("tr",{className:"emit-control-row"},m("td",{className:"emit-control-label"},m(X(),{onclick:t.toggleRow(r)},e[r].content)),m("td",{className:"emit-control-event"},m(z(),{onchange:t.changeStateCbMaker("event",r),state:t.checked("event",r),disabled:!t.checkType("event",r)})),m("td",{className:"emit-control-update"},m(z(),{onchange:t.changeStateCbMaker("update",r),state:t.checked("update",r),disabled:!t.checkType("update",r)})),m("td",{className:"emit-control-manual"},m(z(),{onchange:t.changeStateCbMaker("manual",r),state:t.checked("manual",r),disabled:!t.checkType("manual",r)})),m("td",{className:"emit-control-abs"},m(z(),{onchange:t.changeStateCbMaker("abs",r),state:t.checked("abs",r)}),I(t.checkType("abs",r),"",m("span",null,m(K(),{text:n().translator.trans("xypp-collector.admin.limited_accumulation_support")},m("i",{class:"fas fa-exclamation-triangle"}))))))}))},r.checked=function(t,n){return!(!this.checkType(t,n)&&"abs"!=t||this.autoEmitObj[t]&&!0===this.autoEmitObj[t][n])},r.checkType=function(t,e){var r=h.getInstance(n()).getRawConditionDefinition(e);return"event"===t?!(r&&r.manual):"update"===t?r&&r.update:"manual"===t?r&&r.manual:"abs"===t&&r&&r.abs},r.toggleRow=function(t){var n=this;return function(e){e.preventDefault();var r=["event","update","manual"].filter((function(e){return n.checkType(e,t)})).concat("abs"),a=void 0===r.find((function(e){return n.autoEmitObj[e]&&n.autoEmitObj[e][t]}));r.forEach((function(e){n.autoEmitObj[e]||(n.autoEmitObj[e]={}),a?n.autoEmitObj[e][t]=!0:n.autoEmitObj[e][t]&&delete n.autoEmitObj[e][t]})),n.autoEmit(JSON.stringify(n.autoEmitObj))}.bind(this)},r.toggleAll=function(t){var e=this;return function(r){r.preventDefault();var a=Object.keys(h.getInstance(n()).getAllConditions(!0).toObject()).filter((function(n){return e.checkType(t,n)||"abs"===t}));e.autoEmitObj[t]||(e.autoEmitObj[t]={});var o=!1;0==Object.keys(e.autoEmitObj[t]).length&&(o=!0),a.forEach((function(n){o?e.autoEmitObj[t][n]=!0:e.autoEmitObj[t][n]&&delete e.autoEmitObj[t][n]})),e.autoEmit(JSON.stringify(e.autoEmitObj))}.bind(this)},r.changeStateCbMaker=function(t,n){var e=this;return function(r){e.autoEmitObj[t]||(e.autoEmitObj[t]={}),r?e.autoEmitObj[t][n]&&delete e.autoEmitObj[t][n]:e.autoEmitObj[t][n]=!0,e.autoEmit(JSON.stringify(e.autoEmitObj))}.bind(this)},r.getValidTags=function(){var t=this;return n().store.all("tags").map((function(n){return m(z(),{onchange:t.changeValidTagsStateCbMaker(n),state:!t.invalidTagsObj[n.id()||0]},n.name())}))},r.changeValidTagsStateCbMaker=function(t){var n=this;return function(e){e?n.invalidTagsObj[t.id()||0]&&delete n.invalidTagsObj[t.id()||0]:n.invalidTagsObj[t.id()||0]=!0,n.invalidTags(JSON.stringify(n.invalidTagsObj))}.bind(this)},r.customEdit=function(t){var e=this;return function(r){r.preventDefault(),n().modal.show(tt,{item:t,update:function(t){var n;e.customs=null==(n=e.customs)?void 0:n.map((function(n){return n.id()==t.id()?t:n})),m.redraw()}})}},r.customAdd=function(){var t=this;return function(e){e.preventDefault(),n().modal.show(tt,{update:function(n){var e;null==(e=t.customs)||e.push(n),m.redraw()}})}},r.customDelete=function(t){var e=this;return function(r){r.preventDefault(),confirm(n().translator.trans("xypp-collector.admin.custom.delete-confirm")+"")&&(e.deletingCustom[t.id()+""]=!0,m.redraw(),t.delete().then((function(){var n;e.customs=null==(n=e.customs)?void 0:n.filter((function(n){return n.id()!=t.id()})),delete e.deletingCustom[t.id()+""],m.redraw()})))}},e}(J());n().initializers.add("xypp/collector",(function(){var t,e;t=n(),e="xypp-collector."+"admin"+".integration",flarum.extensions["xypp-store"]&&function(t,n){var e={};g("store_item",(function(r){var a=t.store.getById("store-item",r);return a?a.attribute("name"):void 0===e[r]?(e[r]=!0,t.store.find("store-item",r).then((function(){m.redraw()})).catch((function(){e[r]=!1})),t.translator.trans(n+".reward.store_item_loading")+""):!1===e[r]?t.translator.trans(n+".reward.store_item_error")+"":t.translator.trans(n+".reward.store_item_loading")+""})),b("store_item",o(s().mark((function e(){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.store.find("store-item");case 2:return r=e.sent,a=r.reduce((function(t,n){return t[n.id()]=n.attribute("name"),t}),{}),e.next=6,C.open(t,a,t.translator.trans(n+".reward.store_item_select"),t.translator.trans(n+".reward.store_item_select_button"));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))))}(t,e),flarum.extensions["v17development-user-badges"]&&function(t,n){var e={};g("badge",(function(r){var a=t.store.getById("badges",r);return a?a.attribute("name"):void 0===e[r]?(e[r]=!0,t.store.find("badges",r).then((function(){m.redraw()})).catch((function(){e[r]=!1})),t.translator.trans(n+".reward.badge_loading")+""):!1===e[r]?t.translator.trans(n+".reward.badge_error")+"":t.translator.trans(n+".reward.badge_loading")+""})),b("badge",o(s().mark((function e(){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.store.find("badges");case 2:return r=e.sent,a=r.reduce((function(t,n){return t[n.id()]=n.attribute("name"),t}),{}),e.next=6,C.open(t,a,t.translator.trans(n+".reward.badge_select"),t.translator.trans(n+".reward.badge_select_button"));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))))}(t,e),n().extensionData.for("xypp-collector").registerPage(nt).registerPermission({icon:"fas fa-eye",label:n().translator.trans("xypp-collector.admin.permissions.view-condition"),permission:"user.view-condition"},"moderate",30)}));const et=flarum.core.compat["common/extenders"],rt=[(new(e.n(et)().Store)).add("condition",L).add(Z.type,Z)]})(),module.exports=r})();
//# sourceMappingURL=admin.js.map